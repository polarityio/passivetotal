{{#if errorMessage}}
  <div class='alert alert-danger error-container'>
    <div class="error-title d-flex justify-content-between align-items-center mb-1">
      <div class="d-flex align-items-center">
        {{fa-icon icon="exclamation-circle" fixedWidth=true class="red-icon"}} Error Loading Data
      </div>
      <button class="btn clear-error-button" {{action "clearError"}}>{{fa-icon icon="times" fixedWidth=true}}</button>
    </div>
    <pre>{{errorMessage}}</pre>
  </div>
{{/if}}

{{#if enabledDataSourcesMisconfigured}}
  <div class='alert alert-danger error-container'>
    <div class="error-title d-flex justify-content-between align-items-center mb-1">
      <div class="d-flex align-items-center">
        {{fa-icon icon="exclamation-circle" fixedWidth=true class="red-icon"}} Integration Misconfigured
      </div>
    </div>
    <pre>Please ask a Polarity admin to ensure the "Enabled Datasources" option is set to "Users can view and edit" or "Users can view only".</pre>
  </div>
{{/if}}

{{#if
  (or
    details.summary.isConnectionReset
    details.summary.maxRequestQueueLimitHit
    details.summary.isGatewayTimeout
    details.summary.apiKeyLimitReached
  )
}}
  {{#unless details.summary.apiKeyLimitReached}}
    <button type='button' class='btn btn-polarity btn-sm retry-btn' {{action 'retrySearch' 'summary'}}>
      {{#if block._state.searchRunning.summary}}
        {{fa-icon icon='spinner-third' fixedWidth=true spin=true}}
      {{else}}
        Retry Search
      {{/if}}
    </button>
    <div class='mt-1'>
      <span>A temporary PassiveTotal API search limit was reached. You can retry your search by pressing the "Retry
        Search" button.</span>
    </div>
  {{/unless}}
  {{#if details.summary.apiKeyLimitReached}}
    <div class='mt-1'>
      <span>You have reached your PassiveTotal API Search Quota. Please view your Search Quota below to determine when
        you will be able to run searches again.</span>
      <div class='mt-1'>
        <a class='p-link' href='https://community.riskiq.com/research?query={{block.entity.value}}'>Run Search via
          PassiveTotal Web Interface
          {{fa-icon 'external-link-square' class='external-link-icon'}}</a>
      </div>
      <div>
        <span class='p-footnote'>Use the link to run this search via the PassiveTotal website which uses a different
          quota.</span>
      </div>
      {{! Get Quota Information }}
      <div class='mt-1'>
        <span class='p-action' {{action 'showQuota'}}>
          {{#if block._state.viewQuota}}
            Hide Search Quota
            {{fa-icon icon='chevron-up'}}
          {{else}}
            View Search Quota
            {{fa-icon icon='chevron-down'}}
          {{/if}}
        </span>
        {{#if block._state.searchRunning.quota}}
          <div class='mt-1'>
            {{fa-icon icon='spinner-third' fixedWidth=true spin=true}}
            Loading Quota ...
          </div>
        {{/if}}
        {{#if block._state.viewQuota}}
          {{#if details.quota}}
            <div class='quota-container mt-1'>
              {{#if details.quota.user}}
                <div>
                  <div>
                    <span class='p-title mt-0'>{{fa-icon icon='user' fixedWidth=true}} Your User Search Quota</span>
                  </div>
                  <div>
                    <span class='p-key'>API Searches:</span>
                    <span class='p-value'>{{details.quota.user.licenseCounts.searchApi}}
                      of
                      {{details.quota.user.licenseLimits.searchApi}}
                      used</span>
                  </div>
                  <div>
                    <span class='p-key'>Quota Duration: </span>
                    <span class='p-value'>{{details.quota.user.quotaInterval}}</span>
                  </div>
                  <div>
                    <span class='p-key'>Next Quota Reset: </span>
                    <span class='p-value'>{{details.quota.user.next_reset}}</span>
                  </div>
                </div>
              {{/if}}
              {{#if details.quota.organization}}
                <div class='mt-1'>
                  <div>
                    <span class='p-title'>{{fa-icon icon='building' fixedWidth=true}}
                      Your Organization Search Quota</span>
                  </div>
                  <div>
                    <span class='p-key'>API Searches: </span>
                    <span class='p-value'>{{details.quota.organization.licenseCounts.enterprise.searchApi}}
                      of
                      {{details.quota.organization.licenseLimits.enterprise.searchApi}}
                      used</span>
                  </div>
                  <div>
                    <span class='p-key'>Quota Duration:</span>
                    <span>{{details.quota.organization.quotaInterval}}</span>
                  </div>
                  <div>
                    <span class='p-key'>Next Quota Reset: </span>
                    <span class='p-value'>{{details.quota.organization.next_reset}}</span>
                  </div>
                </div>
              {{/if}}
              <span class='reload-quota-btn' {{action 'getQuota'}}>
                {{fa-icon
                  icon='sync'
                  fixedWidth=true
                  class='icon'
                  title='Refresh Quota'
                  spin=(if block._state.searchRunning.quota true false)
                }}
              </span>
            </div>
          {{/if}}
        {{/if}}
      </div>
    </div>
  {{/if}}
{{else if details}}
  {{#if (not-eq block.entity.type 'custom')}}
    {{! IPv4 and Domain output parsing}}
    <ul class='nav nav-tabs'>
      <li class='nav-item'>
        <a {{action 'changeTab' 'summary'}} class='nav-link {{if (eq activeTab "summary") "active"}}' href='#'>Data Card</a>
      </li>

      {{#if (gt summary.data_summary.resolutions.count 0)}}
        <li class='nav-item'>
          <a
            {{action 'changeTab' 'pdns'}}
            class='nav-link {{if (or (eq activeTab "pdns") (not activeTab)) "active"}}'
            href='#'
          >
            Resolutions
            {{#if block._state.searchRunning.pdns}}{{fa-icon
                'spinner-third'
                fixedWidth=true
                spin=true
                class='loading-icon'
              }}{{/if}}
            {{#if pdnsIsLoaded}}
              ({{details.pdns.totalRecords}})
            {{/if}}
          </a>
        </li>
      {{/if}}
      <li class='nav-item'>
        <a
          {{action 'changeTab' 'whois'}}
          class='nav-link {{if (or (eq activeTab "whois") (not activeTab)) "active"}}'
          href='#'
        >
          WHOIS
          {{#if block._state.searchRunning.whois}}{{fa-icon
              'spinner-third'
              fixedWidth=true
              spin=true
              class='loading-icon'
            }}{{/if}}
          {{#if details.whois.totalRecords}}
            ({{if details.whois.totalRecords details.whois.totalRecords '(1)'}})
          {{/if}}
        </a>
      </li>
    </ul>

    {{#if (eq activeTab 'whois')}}
      {{#if (and block._state.searchRunning.whois (not block._state.initialLoadAttempted.whois))}}
        <div class="loading-message mt-2">
          {{fa-icon icon='spinner-third' fixedWidth=true spin=true}}
          Loading WHOIS
        </div>
      {{else if (or
        details.whois.isConnectionReset
        details.whois.maxRequestQueueLimitHit
        details.whois.isGatewayTimeout
        details.whois.apiKeyLimitReached
        details.whois.onMessageTimeout
      )}}
        {{#unless details.whois.apiKeyLimitReached}}
          <button type='button' class='btn btn-polarity btn-sm retry-btn mt-1' {{action 'retrySearch' 'whois'}}>
            {{#if block._state.searchRunning.whois}}
              {{fa-icon icon='spinner-third' fixedWidth=true spin=true}}
            {{else}}
              Retry WHOIS Search
            {{/if}}
          </button>
        {{/unless}}
        <div class='mt-1'>
          {{#if details.whois.onMessageTimeout}}
            <span>The PassiveTotal API took too long to respond. You can retry your search by pressing the "Retry WHOIS
              Search" button.</span>
            <div class='mt-1'>
              <a class='p-link' href='https://community.riskiq.com/research?query={{block.entity.value}}'>Run Search via
                PassiveTotal Web Interface
                {{fa-icon 'external-link-square' class='external-link-icon'}}</a>
            </div>
            <div>
              <span class='p-footnote'>Some searches via the PassiveTotal API take too long to respond. Click the link
                to run the search via the PassiveTotal website instead.</span>
            </div>
          {{else if details.whois.apiKeyLimitReached}}
            <span>{{fa-icon icon='exclamation-circle' fixedWidth=true class='details-icon'}}
              You have reached your PassiveTotal API Search Quota. Please view your Search Quota below to determine when
              you will be able to run searches again.</span>
            <div class='mt-1'>
              <a class='p-link' href='https://community.riskiq.com/research?query={{block.entity.value}}'>Run Search via
                PassiveTotal Web Interface
                {{fa-icon 'external-link-square' class='external-link-icon'}}</a>
            </div>
            <div>
              <span class='p-footnote'>Use the link to run this search via the PassiveTotal website which uses a
                different quota.</span>
            </div>
            {{#if details.quota.user}}
              <div class='mt-1'>
                <div>
                  <span class='p-title'>{{fa-icon icon='user' fixedWidth=true}} Your User Search Quota</span>
                </div>
                <div>
                  <span class='p-key'>API Searches:</span>
                  <span class='p-value'>{{details.quota.user.licenseCounts.searchApi}}
                    of
                    {{details.quota.user.licenseLimits.searchApi}}
                    used</span>
                </div>
                <div>
                  <span class='p-key'>Quota Duration: </span>
                  <span class='p-value'>{{details.quota.user.quotaInterval}}</span>
                </div>
                <div>
                  <span class='p-key'>Next Quota Reset: </span>
                  <span class='p-value'>{{details.quota.user.next_reset}}</span>
                </div>
              </div>
            {{/if}}
            {{#if details.quota.organization}}
              <div class='mt-1'>
                <div>
                  <span class='p-title mt-0'>{{fa-icon icon='building' fixedWidth=true}}
                    Your Organization Search Quota</span>
                </div>
                <div>
                  <span class='p-key'>API Searches: </span>
                  <span class='p-value'>{{details.quota.organization.licenseCounts.enterprise.searchApi}}
                    of
                    {{details.quota.organization.licenseLimits.enterprise.searchApi}}
                    used</span>
                </div>
                <div>
                  <span class='p-key'>Quota Duration:</span>
                  <span>{{details.quota.organization.quotaInterval}}</span>
                </div>
                <div>
                  <span class='p-key'>Next Quota Reset: </span>
                  <span class='p-value'>{{details.quota.organization.next_reset}}</span>
                </div>
              </div>
            {{/if}}
          {{else}}
            <div class='mt-1'>
              <span>A temporary PassiveTotal API search limit was reached. You can retry your search by pressing the
                "Retry WHOIS Search" button.</span>
            </div>
          {{/if}}
        </div>
      {{else}}
        {{#if details.whois}}
          <div class="position-fixed-scrollable-container sticky-container whois-container">
            {{#each details.whois.data.whoisData as |record index|}}
                <div class="d-flex align-items-center justify-content-between sticky-header {{if (eq details.whois.data.whoisData.length 1) "no-hover"}}" {{action "toggleWhoisRecord" index}}>
                  <div class="d-flex align-items-center">
                    <div class="mr-2">
                      <span class='p-value'>
                        {{moment-format
                          record.data.registryUpdatedAt
                          'YYYY-MM-DD'
                          timeZone=timezone
                        }}
                      </span>
                    </div>
                    <div class="d-flex align-items-center justify-space-between icon-container">
                      {{fa-icon title="Email changed" icon="envelope" fixedWidth=true class=(if (not record.diffSummary.email) "hide-icon")}}
                      {{fa-icon title="Phone number changed" icon="phone" fixedWidth=true class=(if (not record.diffSummary.phone) "hide-icon")}}
                      {{fa-icon title="Organization information changed" icon="building" fixedWidth=true class=(if (not record.diffSummary.org) "hide-icon")}}
                      {{fa-icon title="Nameservers changed" icon="globe" fixedWidth=true class=(if (not record.diffSummary.nameServers) "hide-icon")}}
                      {{fa-icon title="Whois Server, Registrar or Domain status changed" icon="server" fixedWidth=true class=(if (not record.diffSummary.whoisServer) "hide-icon")}}
                    </div>
                  </div>
                  {{!-- --}}
                  {{#unless (eq details.whois.data.whoisData.length 1)}}
                    <div class="d-flex align-items-center ">
                      {{#if record._isVisible}}
                        {{fa-icon icon="chevron-up" fixedWidth=true class="toggle-icon p-action"}}
                      {{else}}
                        {{fa-icon icon="chevron-down" fixedWidth=true class="toggle-icon p-action"}}
                      {{/if}}
                    </div>
                  {{/unless}}
                </div>
                {{#if (or record._isVisible (eq details.whois.data.whoisData.length 1))}}
                  <div class="padded sticky-body">
                    {{#each details.whois.data.whoisTemplate as | template |}}
                      {{#if (eq template.type "text")}}
                        {{#if (get record.diff template.path)}}
                          {{#let (get record.diff template.path) as | diffRecord |}}
                            {{#if (eq (get diffRecord 1) 0)}}
                              {{!-- value was removed --}}
                              <div class="diff-old-container">
                                <span class='diff-old p-key'>{{template.display}}: </span>
                                <span class='diff-old p-value'>{{get diffRecord 0}}</span>
                              </div>
                            {{else if (eq diffRecord.length 1)}}
                              {{!-- value was added --}}
                              <div class="diff-new-container">
                                <span class='diff-new p-key'>{{template.display}}: </span>
                                <span class='diff-new p-value'>{{get diffRecord 0}}</span>
                              </div>
                            {{else}}
                              {{!-- value was replaced/changed --}}
                              <div class="diff-new-container">
                                <span class='diff-new p-key'>{{template.display}}: </span>
                                <span class='diff-new p-value'>{{get diffRecord 0}}</span>
                              </div>
                              <div class="diff-old-container">
                                <span class='diff-old p-key'>{{template.display}}: </span>
                                <span class='diff-old p-value'>{{get diffRecord 1}}</span>
                              </div>
                            {{/if}}
                          {{/let}}
                        {{else if (get record.data template.path)}}
                          <div>
                            <span class='p-key'>{{template.display}}: </span>
                            <span class='p-value'>{{get record.data template.path}}</span>
                          </div>
                        {{/if}}
                      {{else if (and (get record.data template.path) (eq template.type "date"))}}
                        {{!-- Note that we don't run diffs on dates so there is no need for diff rendering logic here --}}
                        <div>
                          <span class='p-key'>{{template.display}}: </span>
                          <span class='p-value'>
                            {{moment-format
                              (get record.data template.path)
                              'MM/DD/YYYY HH:mm:ss'
                              timeZone=timezone
                            }}
                          </span>
                        </div>
                      {{else if (eq template.type "title")}}
                        {{!-- don't show titles if the section the title refers to has no data in it (i.e., is an empty object --}}
                        {{#unless (is-empty (get record.data template.path))}}
                          <h1 class='p-title'>
                            {{fa-icon icon=template.icon fixedWidth=true}}
                            {{template.display}}
                          </h1>
                        {{/unless}}
                      {{else if (eq template.type "list")}}
                        <h1 class='p-title'>
                          {{fa-icon icon=template.icon fixedWidth=true}}
                          {{template.display}}
                        </h1>
                        {{#each (get record.data template.path) as | item index|}}
                          {{#let (get record.diff template.path) as | diffRecord |}}
                            {{#if (get diffRecord index)}}
                              {{#let (get diffRecord index) as | diffRecordListItem |}}
                                {{!-- this list item had a change --}}
                                {{#if (eq (get diffRecordListItem 1) 0)}}
                                  {{!-- value was removed --}}
                                  <div class="diff-old-container">
                                    <span class='diff-old p-value'>{{get diffRecordListItem 0}}</span>
                                  </div>
                                {{else if (eq diffRecordListItem.length 1)}}
                                  {{!-- value was added --}}
                                  <div class="diff-new-container">
                                    <span class='diff-new p-value'>{{get diffRecordListItem 0}}</span>
                                  </div>
                                {{else}}
                                  {{!-- value was replaced/changed --}}
                                  <div class="diff-new-container">
                                    <span class='diff-new p-value'>{{get diffRecordListItem 0}}</span>
                                  </div>
                                  <div class="diff-old-container">
                                    <span class='diff-old p-value'>{{get diffRecordListItem 1}}</span>
                                  </div>
                                {{/if}}
                              {{/let}}
                            {{else}}
                              {{!-- no change on this list item --}}
                              <div>{{item}}</div>
                            {{/if}}
                          {{/let}}
                        {{/each}}
                        {{!--
                        We also need to render any items that were removed as they will no longer be in the original data
                        Loop through all the diff results, and if any diff result is a removal object (length of 3), then
                        display that item as removed.  This works because when we compute the diff we don't include
                        array move operations so the only valid diff actions are "add" and "remove".
                        --}}
                        {{#let (get record.diff template.path) as | diffRecord |}}
                          {{#each-in diffRecord as |key diffRecordListItem|}}
                            {{!-- if the key starts with an underscore, then it is a diff removal --}}
                            {{#if (eq diffRecordListItem.length 3)}}
                              {{!-- value was removed --}}
                              <div class="diff-old-container">
                                <span class='diff-old p-value'>{{get diffRecordListItem 0}}</span>
                              </div>
                            {{/if}}
                          {{/each-in}}
                        {{/let}}
                      {{/if}}
                    {{/each}}
                  </div>
                {{/if}} {{!-- end of whois record --}}
              {{/each}}
          </div>
        {{else if details.whois.accessDenied}}
          <div class='alert alert-warning' role='alert'>
            <div>Your API Key does not have access to the WHOIS data.</div>
            <div class="p-footnote mt-1">
              You can disable this data source via the integration's "Datasources" option.
            </div>
          </div>
        {{else}}
          <div>
            No WHOIS Details Found
          </div>
        {{/if}}
      {{/if}}
    {{/if}}
  {{/if}}

  {{!-- Data Card --}}
  {{#if (eq activeTab 'summary')}}
    <div class="sticky-container position-fixed-scrollable-container">
        {{!-- start of data card --}}
        <div class="sticky-header" {{action "toggleShowResults" "summary"}}>
          <div>
            {{fa-icon icon="id-card" fixedWidth=true class="sticky-header-icon"}}
            Data Card
          </div>
          <div class="p-action">
            {{fa-icon (if block._state.visible.services 'caret-up' 'caret-down') fixedWidth=true}}
          </div>
        </div>
        {{#if block._state.visible.summary}}
          <div class="padded sticky-body">
            {{#if summary.name}}
              <div>
                <span class='p-key'>Name: </span>
                <span class='p-value'><a href='{{summary.link}}'>{{summary.name}}
                  {{fa-icon 'external-link-square' class='external-link-icon'}}</a></span>
              </div>
            {{/if}}
            {{#if summary.type}}
              <div>
                <span class='p-key'>Type: </span>
                <span class='p-value'>{{summary.type}}</span>
              </div>
            {{/if}}
            {{#if summary.netblock}}
              {{#if (not-eq summary.netblock 'n/a')}}
                <div>
                  <span class='p-key'>Netblock: </span>
                  <span class='p-value'>{{summary.netblock}}</span>
                </div>
              {{/if}}
            {{/if}}
            {{#if summary.os}}
              {{#if (not-eq summary.os 'n/a')}}
                <div>
                  <span class='p-key'>OS: </span>
                  <span class='p-value'>{{summary.os}}</span>
                </div>
              {{/if}}
            {{/if}}
            {{#if summary.asn}}
              {{#if (not-eq summary.asn 'n/a')}}
                <div>
                  <span class='p-key'>ASN: </span>
                  <span class='p-value'>{{summary.asn}}</span>
                </div>
              {{/if}}
            {{/if}}
            {{#if summary.hosting_provider}}
              {{#if (not-eq summary.hosting_provider 'n/a')}}
                <div>
                  <span class='p-key'>Hosting Provider: </span>
                  <span class='p-value'>{{summary.hosting_provider}}</span>
                </div>
              {{/if}}
            {{/if}}
            {{#if summary.data_summary.resolutions}}
              {{#if (gt summary.data_summary.resolutions.count 0)}}
                <div>
                  <span class='p-key'>Resolutions: </span>
                  <span class='p-value'><a
                          href='{{summary.data_summary.resolutions.link}}'
                  >{{summary.data_summary.resolutions.count}}
                    {{fa-icon 'external-link-square' class='external-link-icon'}}</a></span>
                </div>
              {{/if}}
            {{/if}}
            {{#if summary.data_summary.certificates}}
              {{#if (gt summary.data_summary.certificates.count 0)}}
                <div>
                  <span class='p-key'>Certificates: </span>
                  <span class='p-value'><a
                          href='{{summary.data_summary.certificates.link}}'
                  >{{summary.data_summary.certificates.count}}
                    {{fa-icon 'external-link-square' class='external-link-icon'}}</a></span>
                </div>
              {{/if}}
            {{/if}}
            {{#if summary.data_summary.hashes}}
              {{#if (gt summary.data_summary.hashes.count 0)}}
                <div>
                  <span class='p-key'>Hashes: </span>
                  <span class='p-value'><a href='{{summary.data_summary.hashes.link}}'>{{summary.data_summary.hashes.count}}
                    {{fa-icon 'external-link-square' class='external-link-icon'}}</a></span>
                </div>
              {{/if}}
            {{/if}}
            {{#if summary.data_summary.projects}}
              {{#if (gt summary.data_summary.projects.count 0)}}
                <div>
                  <span class='p-key'>Projects: </span>
                  <span class='p-value'><a href='{{summary.data_summary.projects.link}}'>{{summary.data_summary.projects.count}}
                    {{fa-icon 'external-link-square' class='external-link-icon'}}</a></span>
                </div>
              {{/if}}
            {{/if}}
            {{#if summary.data_summary.articles}}
              {{#if (gt summary.data_summary.articles.count 0)}}
                <div>
                  <span class='p-key'>Articles: </span>
                  <span class='p-value'><a href='{{summary.data_summary.articles.link}}'>{{summary.data_summary.articles.count}}
                    {{fa-icon 'external-link-square' class='external-link-icon'}}</a></span>
                </div>
              {{/if}}
            {{/if}}
            {{#if summary.data_summary.trackers}}
              {{#if (gt summary.data_summary.trackers.count 0)}}
                <div>
                  <span class='p-key'>Trackers: </span>
                  <span class='p-value'><a href='{{summary.data_summary.trackers.link}}'>{{summary.data_summary.trackers.count}}
                    {{fa-icon 'external-link-square' class='external-link-icon'}}</a></span>
                </div>
              {{/if}}
            {{/if}}
            {{#if summary.data_summary.components}}
              {{#if (gt summary.data_summary.components.count 0)}}
                <div>
                  <span class='p-key'>Components: </span>
                  <span class='p-value'><a
                          href='{{summary.data_summary.components.link}}'
                  >{{summary.data_summary.components.count}}
                    {{fa-icon 'external-link-square' class='external-link-icon'}}</a></span>
                </div>
              {{/if}}
            {{/if}}
            {{#if summary.data_summary.host_pairs}}
              {{#if (gt summary.data_summary.host_pairs.count 0)}}
                <div>
                  <span class='p-key'>Host Pairs: </span>
                  <span class='p-value'><a
                          href='{{summary.data_summary.host_pairs.link}}'
                  >{{summary.data_summary.host_pairs.count}}
                    {{fa-icon 'external-link-square' class='external-link-icon'}}</a></span>
                </div>
              {{/if}}
            {{/if}}
            {{#if summary.data_summary.cookies}}
              {{#if (gt summary.data_summary.cookies.count 0)}}
                <div>
                  <span class='p-key'>Cookies: </span>
                  <span class='p-value'><a href='{{summary.data_summary.cookies.link}}'>{{summary.data_summary.cookies.count}}
                    {{fa-icon 'external-link-square' class='external-link-icon'}}</a></span>
                </div>
              {{/if}}
            {{/if}}

            {{#if details.insights}}
              <div class='insights'>
                <div class='toggle-header'>
                  <span class='p-action' {{action 'toggleShowResults' 'showInsights'}}>
                    {{fa-icon 'eye' fixedWidth=true}}
                    Insights
                    {{fa-icon (if showInsights 'caret-up' 'caret-down') fixedWidth=true}}
                  </span>
                </div>

                {{#if showInsights}}
                  {{#if details.insights.global_tags}}
                    <h1 class='insight-tag'>
                      {{fa-icon 'search' fixedWidth=true}}
                      Tags
                    </h1>

                    {{#each details.insights.global_tags as |globalTag|}}
                      <div class='tag-value'>
                        <span class='tag'>{{globalTag}}</span>
                      </div>
                    {{/each}}
                  {{/if}}
                  {{#if details.insights.tags}}
                    <h1 class='insight-tag'>
                      {{fa-icon 'globe' fixedWidth=true}}
                      Global Tags
                    </h1>

                    {{#each details.insights.tags as |tag|}}
                      <div class='tag-value'>
                        <span class='tag'>{{tag}}</span>
                      </div>
                    {{/each}}
                  {{/if}}
                  {{#if details.insights.system_tags}}
                    <h1 class='insight-tag'>
                      {{fa-icon 'solar-system' fixedWidth=true}}
                      System Tags
                    </h1>
                    {{#each details.insights.system_tags as |systemTag|}}
                      <div class='tag-value'>
                        <span class='tag'>{{systemTag}}</span>
                      </div>
                    {{/each}}
                  {{/if}}
                {{/if}}
              </div>
            {{/if}}
            {{! view quota }}
            <div class='mt-1'>
      <span class='p-action' {{action 'showQuota'}}>
        {{#if block._state.viewQuota}}
          Hide Search Quota
          {{fa-icon icon='chevron-up'}}
        {{else}}
          View Search Quota
          {{fa-icon icon='chevron-down'}}
        {{/if}}
      </span>
              {{#if block._state.searchRunning.quota}}
                <div class='mt-1'>
                  {{fa-icon icon='spinner-third' fixedWidth=true spin=true}}
                  Loading Quota ...
                </div>
              {{/if}}
              {{#if block._state.viewQuota}}
                {{#if details.quota}}
                  <div class='quota-container mt-1'>
                    {{#if details.quota.user}}
                      <div>
                        <div>
                          <span class='p-title mt-0'>{{fa-icon icon='user' fixedWidth=true}} Your User Search Quota</span>
                        </div>
                        <div>
                          <span class='p-key'>API Searches:</span>
                          <span class='p-value'>{{details.quota.user.licenseCounts.searchApi}}
                            of
                            {{details.quota.user.licenseLimits.searchApi}}
                            used</span>
                        </div>
                        <div>
                          <span class='p-key'>Quota Duration: </span>
                          <span class='p-value'>{{details.quota.user.quotaInterval}}</span>
                        </div>
                        <div>
                          <span class='p-key'>Next Quota Reset: </span>
                          <span class='p-value'>{{details.quota.user.next_reset}}</span>
                        </div>
                      </div>
                    {{/if}}
                    {{#if details.quota.organization}}
                      <div class='mt-1'>
                        <div>
                  <span class='p-title mt-0'>{{fa-icon icon='building' fixedWidth=true}}
                    Your Organization Search Quota</span>
                        </div>
                        <div>
                          <span class='p-key'>API Searches: </span>
                          <span class='p-value'>{{details.quota.organization.licenseCounts.enterprise.searchApi}}
                            of
                            {{details.quota.organization.licenseLimits.enterprise.searchApi}}
                            used</span>
                        </div>
                        <div>
                          <span class='p-key'>Quota Duration:</span>
                          <span>{{details.quota.organization.quotaInterval}}</span>
                        </div>
                        <div>
                          <span class='p-key'>Next Quota Reset: </span>
                          <span class='p-value'>{{details.quota.organization.next_reset}}</span>
                        </div>
                      </div>
                    {{/if}}
                    <span class='reload-quota-btn' {{action 'getQuota'}}>
                      {{fa-icon
                              icon='sync'
                              fixedWidth=true
                              class='icon'
                              title='Refresh Quota'
                              spin=(if block._state.searchRunning.quota true false)
                      }}
                    </span>
                  </div>
                {{/if}}
              {{/if}}
            </div>
          </div>
        {{/if}}
        {{!-- end of data card --}}

        {{!-- start of services --}}
        {{#if enabledDatasources.services}}
          <div class='sticky-header' {{action 'toggleShowResults' 'services'}}>
          <div>
            {{fa-icon icon="ethernet" fixedWidth=true class="sticky-header-icon"}}
            Services/Ports
            {{#if details.services.data.services.length}}
              {{#if block._state.expanded.services}}
                ({{details.services.data.services.length}})
              {{else}}
                (10/{{details.services.data.services.length}})
              {{/if}}
            {{/if}}
          </div>
            {{#if (and block._state.visible.services (gt details.services.data.services.length 10))}}
              <div>
                <span class="header-action" {{action "toggleExpanded" "services" bubbles=false}}>
                  {{#if details.services.data.services.length}}
                    {{#if block._state.expanded.services}}
                      Show fewer results
                    {{else}}
                      Show all results
                    {{/if}}
                  {{/if}}
                </span>
              </div>
            {{/if}}
          <div class="p-action">
            {{fa-icon (if block._state.visible.services 'caret-up' 'caret-down') fixedWidth=true}}
          </div>
        </div>
          {{#if block._state.visible.services}}
          <div class="padded sticky-body">
            {{#if (and block._state.searchRunning.services (not block._state.initialLoadAttempted.services))}}
              <div>
                {{fa-icon icon='spinner-third' fixedWidth=true spin=true}}
                Loading Services
              </div>
            {{else if (or
                    details.services.isConnectionReset
                    details.services.maxRequestQueueLimitHit
                    details.services.isGatewayTimeout
                    details.services.apiKeyLimitReached
                    details.services.onMessageTimeout
            )}}
              {{#unless details.services.apiKeyLimitReached}}
                <button type='button' class='btn btn-polarity btn-sm retry-btn mt-1' {{action 'retrySearch' 'services'}}>
                  {{#if block._state.searchRunning.services}}
                    {{fa-icon icon='spinner-third' fixedWidth=true spin=true}}
                  {{else}}
                    Retry Pairs Search
                  {{/if}}
                </button>
              {{/unless}}
              <div class='mt-1'>
                {{#if details.services.onMessageTimeout}}
                  <span>The PassiveTotal API took too long to respond. You can retry your search by pressing the "Retry Pairs
                    Search" button.</span>
                  <div class='mt-1'>
                    <a class='p-link' href='https://community.riskiq.com/research?query={{block.entity.value}}'>Run Search via
                      PassiveTotal Web Interface
                      {{fa-icon 'external-link-square' class='external-link-icon'}}</a>
                  </div>
                  <div>
                    <span class='p-footnote'>Some searches via the PassiveTotal API take too long to respond. Click the link
                      to run the search via the PassiveTotal website instead.</span>
                  </div>
                {{else if details.services.apiKeyLimitReached}}
                  <span>{{fa-icon icon='exclamation-circle' fixedWidth=true class='details-icon'}}
                    You have reached your PassiveTotal API Search Quota. Please view your Search Quota below to determine when
                    you will be able to run searches again.</span>
                  <div class='mt-1'>
                    <a class='p-link' href='https://community.riskiq.com/research?query={{block.entity.value}}'>Run Search via
                      PassiveTotal Web Interface
                      {{fa-icon 'external-link-square' class='external-link-icon'}}</a>
                  </div>
                  <div>
                    <span class='p-footnote'>Use the link to run this search via the PassiveTotal website which uses a
                      different quota.</span>
                  </div>
                  {{#if details.quota.user}}
                    <div class='mt-1'>
                      <div>
                        <span class='p-title'>{{fa-icon icon='user' fixedWidth=true}} Your User Search Quota</span>
                      </div>
                      <div>
                        <span class='p-key'>API Searches:</span>
                        <span class='p-value'>{{details.quota.user.licenseCounts.searchApi}}
                          of
                          {{details.quota.user.licenseLimits.searchApi}}
                          used</span>
                      </div>
                      <div>
                        <span class='p-key'>Quota Duration: </span>
                        <span class='p-value'>{{details.quota.user.quotaInterval}}</span>
                      </div>
                      <div>
                        <span class='p-key'>Next Quota Reset: </span>
                        <span class='p-value'>{{details.quota.user.next_reset}}</span>
                      </div>
                    </div>
                  {{/if}}
                  {{#if details.quota.organization}}
                    <div class='mt-1'>
                      <div>
                        <span class='p-title mt-0'>{{fa-icon icon='building' fixedWidth=true}}
                          Your Organization Search Quota</span>
                      </div>
                      <div>
                        <span class='p-key'>API Searches: </span>
                        <span class='p-value'>{{details.quota.organization.licenseCounts.enterprise.searchApi}}
                          of
                          {{details.quota.organization.licenseLimits.enterprise.searchApi}}
                          used</span>
                      </div>
                      <div>
                        <span class='p-key'>Quota Duration:</span>
                        <span>{{details.quota.organization.quotaInterval}}</span>
                      </div>
                      <div>
                        <span class='p-key'>Next Quota Reset: </span>
                        <span class='p-value'>{{details.quota.organization.next_reset}}</span>
                      </div>
                    </div>
                  {{/if}}
                {{else}}
                  <div class='mt-1'>
                    <span>A temporary PassiveTotal API search limit was reached. You can retry your search by pressing the
                      "Retry Pairs Search" button.</span>
                  </div>
                {{/if}}
              </div>
            {{else}}

              {{#if details.services.data.services}}
                <div class='mb-2'>
                  <h1 class='p-title'>
                    {{fa-icon 'network-wired' fixedWidth=true}}
                    Service Details
                  </h1>
                  {{#each (take (if block._state.expanded.services details.services.data.services.length 10) details.services.data.services) as |service index|}}
                    {{#if (gt index 0)}}
                      <hr />
                    {{/if}}
                    {{#if service.portNumber}}
                      <div>
                        <span class='p-key'>Port Number: </span>
                        <span class='p-value'>{{service.portNumber}}</span>
                      </div>
                    {{/if}}
                    {{#if service.status}}
                      <div>
                        <span class='p-key'>Status: </span>
                        <span class='p-value'>{{service.status}}</span>
                      </div>
                    {{/if}}
                    {{#if service.protocol}}
                      <div>
                        <span class='p-key'>Protocol: </span>
                        <span class='p-value'>{{service.protocol}}</span>
                      </div>
                    {{/if}}
                    {{! Current Services}}
                    {{#if (get currentServiceStates index)}}
                      <a
                              href='#'
                              class='expandable-title'
                        {{on 'click' (action 'toggleExpandableCurrentServiceTitle' index)}}
                      >
                        <span class='text'><span class='desc'>Current Services:</span> {{UNIQUE_VALUE}}</span>
                        {{fa-icon 'angle-up'}}
                      </a>

                      {{#each service.currentServices as |currentService index|}}
                        <div class='current-service-information'>
                          {{#if currentService.label}}
                            <div>
                              <span class='p-key'>Label: </span>
                              <span class='p-value'>{{currentService.label}}</span>
                            </div>
                          {{/if}}
                          {{#if currentService.category}}
                            <div>
                              <span class='p-key'>Category: </span>
                              <span class='p-value'>{{currentService.category}}</span>
                            </div>
                          {{/if}}
                          {{#if currentService.version}}
                            <div>
                              <span class='p-key'>Version: </span>
                              <span class='p-value'>{{currentService.version}}</span>
                            </div>
                          {{/if}}
                          {{#if currentService.firstSeen}}
                            <div>
                              <span class='p-key'>First Seen: </span>
                              <span class='p-value'>{{moment-format
                                      currentService.firstSeen
                                      'MM/DD/YYYY HH:mm:ss'
                                      timeZone=timezone
                              }}</span>
                            </div>
                          {{/if}}
                          {{#if currentService.lastSeen}}
                            <div>
                              <span class='p-key'>First Seen: </span>
                              <span class='p-value'>{{moment-format
                                      currentService.lastSeen
                                      'MM/DD/YYYY HH:mm:ss'
                                      timeZone=timezone
                              }}</span>
                            </div>
                          {{/if}}
                        </div>
                      {{/each}}
                    {{else}}
                      <a
                              href='#'
                              class='expandable-title'
                        {{on 'click' (action 'toggleExpandableCurrentServiceTitle' index)}}
                      >
                        <span class='text'>Current Services</span>
                        {{fa-icon 'angle-down'}}
                      </a>
                    {{/if}}
                    {{! Recent Services}}
                    {{#if (get recentServiceStates index)}}
                      <a
                              href='#'
                              class='expandable-title'
                        {{on 'click' (action 'toggleExpandableRecentServiceTitle' index)}}
                      >
                        <span class='text'><span class='desc'>Recent Services:</span> {{UNIQUE_VALUE}}</span>
                        {{fa-icon 'angle-up'}}
                      </a>
                      {{#each service.recentServices as |recentService index|}}
                        <div class='recent-service-information'>
                          {{#if recentService.label}}
                            <div>
                              <span class='p-key'>Label: </span>
                              <span class='p-value'>{{recentService.label}}</span>
                            </div>
                          {{/if}}
                          {{#if recentService.category}}
                            <div>
                              <span class='p-key'>Category: </span>
                              <span class='p-value'>{{recentService.category}}</span>
                            </div>
                          {{/if}}
                          {{#if recentService.version}}
                            <div>
                              <span class='p-key'>Version: </span>
                              <span class='p-value'>{{recentService.version}}</span>
                            </div>
                          {{/if}}
                          {{#if recentService.firstSeen}}
                            <div>
                              <span class='p-key'>First Seen: </span>
                              <span class='p-value'>{{moment-format
                                      recentService.firstSeen
                                      'MM/DD/YYYY HH:mm:ss'
                                      timeZone=timezone
                              }}</span>
                            </div>
                          {{/if}}
                          {{#if recentService.lastSeen}}
                            <div>
                              <span class='p-key'>First Seen: </span>
                              <span class='p-value'>{{moment-format
                                      recentService.lastSeen
                                      'MM/DD/YYYY HH:mm:ss'
                                      timeZone=timezone
                              }}</span>
                            </div>
                          {{/if}}
                        </div>
                      {{/each}}
                    {{else}}
                      <a
                              href='#'
                              class='expandable-title'
                        {{on 'click' (action 'toggleExpandableRecentServiceTitle' index)}}
                      >
                        <span class='text'>Recent Services</span>
                        {{fa-icon 'angle-down'}}
                      </a>
                    {{/if}}
                  {{/each}}
                  {{#unless block._state.expanded.services}}
                    <span class="p-footnote">Showing first 10 results</span>
                  {{/unless}}
                </div>
              {{else if details.services.accessDenied}}
                <div class='alert alert-warning' role='alert'>
                  <div>Your API Key does not have access to the Services data source.</div>
                  <div class="p-footnote mt-1">
                    You can disable this data source via the integration's "Datasources" option.
                  </div>
                </div>
              {{else}}
                <div>
                  No Services Found
                </div>
              {{/if}}
            {{/if}}
          </div>
        {{/if}}
        {{/if}}
        {{!-- end of services --}}

        {{!-- start of pairs --}}
        {{#if enabledDatasources.hostPairs}}
          <div class='sticky-header' {{action 'toggleShowResults' 'pairs'}}>
            <div>
              {{fa-icon icon="handshake" fixedWidth=true class="sticky-header-icon"}}
              Host Pairs
              {{#if details.pairs.data.length}}
                {{#if block._state.expanded.pairs}}
                  ({{details.pairs.data.length}})
                {{else}}
                  (10/{{details.pairs.data.length}})
                {{/if}}
              {{/if}}
            </div>
            {{#if (and block._state.visible.pairs (gt details.pairs.data.length 10))}}
              <div>
                <span class="header-action" {{action "toggleExpanded" "pairs" bubbles=false}}>
                  {{#if details.pairs.data.length}}
                    {{#if block._state.expanded.pairs}}
                      Show fewer results
                    {{else}}
                      Show all results
                    {{/if}}
                  {{/if}}
                </span>
              </div>
            {{/if}}
            <div class="p-action">
              {{fa-icon (if block._state.visible.pairs 'caret-up' 'caret-down') fixedWidth=true}}
            </div>
          </div>
          {{#if block._state.visible.pairs}}
          <div class="padded sticky-body">
            {{#if (and block._state.searchRunning.pairs (not block._state.initialLoadAttempted.pairs))}}
              <div class='loading-message' role='alert'>
                {{fa-icon icon='spinner-third' fixedWidth=true spin=true}}
                Loading Host Pairs
              </div>
            {{else if (or
                    details.pairs.isConnectionReset
                    details.pairs.maxRequestQueueLimitHit
                    details.pairs.isGatewayTimeout
                    details.pairs.apiKeyLimitReached
                    details.pairs.onMessageTimeout
            )}}
              {{#unless details.pairs.apiKeyLimitReached}}
                <button type='button' class='btn btn-polarity btn-sm retry-btn mt-1' {{action 'retrySearch' 'pairs'}}>
                  {{#if block._state.searchRunning.pairs}}
                    {{fa-icon icon='spinner-third' fixedWidth=true spin=true}}
                  {{else}}
                    Retry Pairs Search
                  {{/if}}
                </button>
              {{/unless}}
              <div class='mt-1'>
                {{#if details.pairs.onMessageTimeout}}
                  <span>The PassiveTotal API took too long to respond. You can retry your search by pressing the "Retry Pairs
                  Search" button.</span>
                  <div class='mt-1'>
                    <a class='p-link' href='https://community.riskiq.com/research?query={{block.entity.value}}'>Run Search via
                      PassiveTotal Web Interface
                      {{fa-icon 'external-link-square' class='external-link-icon'}}</a>
                  </div>
                  <div>
                  <span class='p-footnote'>Some searches via the PassiveTotal API take too long to respond. Click the link
                    to run the search via the PassiveTotal website instead.</span>
                  </div>
                {{else if details.pairs.apiKeyLimitReached}}
                  <span>{{fa-icon icon='exclamation-circle' fixedWidth=true class='details-icon'}}
                    You have reached your PassiveTotal API Search Quota. Please view your Search Quota below to determine when
                  you will be able to run searches again.</span>
                  <div class='mt-1'>
                    <a class='p-link' href='https://community.riskiq.com/research?query={{block.entity.value}}'>Run Search via
                      PassiveTotal Web Interface
                      {{fa-icon 'external-link-square' class='external-link-icon'}}</a>
                  </div>
                  <div>
                  <span class='p-footnote'>Use the link to run this search via the PassiveTotal website which uses a
                    different quota.</span>
                  </div>
                  {{#if details.quota.user}}
                    <div class='mt-1'>
                      <div>
                        <span class='p-title'>{{fa-icon icon='user' fixedWidth=true}} Your User Search Quota</span>
                      </div>
                      <div>
                        <span class='p-key'>API Searches:</span>
                        <span class='p-value'>{{details.quota.user.licenseCounts.searchApi}}
                          of
                          {{details.quota.user.licenseLimits.searchApi}}
                          used</span>
                      </div>
                      <div>
                        <span class='p-key'>Quota Duration: </span>
                        <span class='p-value'>{{details.quota.user.quotaInterval}}</span>
                      </div>
                      <div>
                        <span class='p-key'>Next Quota Reset: </span>
                        <span class='p-value'>{{details.quota.user.next_reset}}</span>
                      </div>
                    </div>
                  {{/if}}
                  {{#if details.quota.organization}}
                    <div class='mt-1'>
                      <div>
                      <span class='p-title mt-0'>{{fa-icon icon='building' fixedWidth=true}}
                        Your Organization Search Quota</span>
                      </div>
                      <div>
                        <span class='p-key'>API Searches: </span>
                        <span class='p-value'>{{details.quota.organization.licenseCounts.enterprise.searchApi}}
                          of
                          {{details.quota.organization.licenseLimits.enterprise.searchApi}}
                          used</span>
                      </div>
                      <div>
                        <span class='p-key'>Quota Duration:</span>
                        <span>{{details.quota.organization.quotaInterval}}</span>
                      </div>
                      <div>
                        <span class='p-key'>Next Quota Reset: </span>
                        <span class='p-value'>{{details.quota.organization.next_reset}}</span>
                      </div>
                    </div>
                  {{/if}}
                {{else}}
                  <div class='mt-1'>
                  <span>A temporary PassiveTotal API search limit was reached. You can retry your search by pressing the
                    "Retry Pairs Search" button.</span>
                  </div>
                {{/if}}
              </div>
            {{else}}
              {{#if block._state.visible.pairs}}
                {{#if details.pairs.data.length}}
                  {{#each (take (if block._state.expanded.pairs details.pairs.data.length 10) details.pairs.data) as |pair index|}}
                    <div class='mb-2'>
                      {{#if pair.parent}}
                        <div>
                          <span class='p-key'>Parent: </span>
                          <span class='p-value'>{{pair.parent}}</span>
                        </div>
                      {{/if}}
                      {{#if pair.child}}
                        <div>
                          <span class='p-key'>Child: </span>
                          <span class='p-value'>{{pair.child}}</span>
                        </div>
                      {{/if}}
                      {{#if pair.cause}}
                        <div>
                          <span class='p-key'>Cause: </span>
                          <span class='p-value'>{{pair.cause}}</span>
                        </div>
                      {{/if}}
                      {{#if pair.firstSeen}}
                        <div>
                          <span class='p-key'>First Seen: </span>
                          <span class='p-value'>{{pair.firstSeen}}</span>
                        </div>
                      {{/if}}
                      {{#if pair.lastSeen}}
                        <div>
                          <span class='p-key'>Last Seen: </span>
                          <span class='p-value'>{{pair.lastSeen}}</span>
                        </div>
                      {{/if}}
                    </div>
                  {{/each}}
                  {{#unless block._state.expanded.pairs}}
                    <span class="p-footnote">Showing first 10 results</span>
                  {{/unless}}
                {{else if details.pairs.accessDenied}}
                  <div class='alert alert-warning' role='alert'>
                    <div>Your API Key does not have access to Host Pairs data.</div>
                    <div class="p-footnote mt-1">
                      You can disable this data source via the integration's "Datasources" option.
                    </div>
                  </div>
                {{else}}
                  <div>
                    No Host Pairs Details Found
                  </div>
                {{/if}}
              {{/if}}
            {{/if}}
          </div>
        {{/if}}
        {{/if}}
        {{!-- end of pairs --}}

        {{!-- start of reputation --}}
        {{#if enabledDatasources.reputation}}
          <div class='sticky-header' {{action 'toggleShowResults' 'reputation'}}>
            <div>
              {{fa-icon icon="ribbon" fixedWidth=true class="sticky-header-icon"}}
              Reputation
            </div>
            <div class='p-action'>
              {{fa-icon (if block._state.visible.reputation 'caret-up' 'caret-down') fixedWidth=true}}
            </div>
          </div>
          {{#if block._state.visible.reputation}}
            <div class="padded sticky-body">
              {{#if (and block._state.searchRunning.reputation (not block._state.initialLoadAttempted.reputation))}}
                <div class="loading-message">
                  {{fa-icon icon='spinner-third' fixedWidth=true spin=true}}
                  Loading Reputation
                </div>
              {{else if (or
                      details.reputation.isConnectionReset
                      details.reputation.maxRequestQueueLimitHit
                      details.reputation.isGatewayTimeout
                      details.reputation.apiKeyLimitReached
                      details.reputation.onMessageTimeout
              )}}
                {{#unless details.reputation.apiKeyLimitReached}}
                  <button type='button' class='btn btn-polarity btn-sm retry-btn mt-1' {{action 'retrySearch' 'reputation'}}>
                    {{#if block._state.searchRunning.reputation}}
                      {{fa-icon icon='spinner-third' fixedWidth=true spin=true}}
                    {{else}}
                      Retry Reputation Search
                    {{/if}}
                  </button>
                {{/unless}}
                <div class='mt-1'>
                  {{#if details.reputation.onMessageTimeout}}
                    <span>The PassiveTotal API took too long to respond. You can retry your search by pressing the "Retry
                      Reputation Search" button.</span>
                    <div class='mt-1'>
                      <a class='p-link' href='https://community.riskiq.com/research?query={{block.entity.value}}'>Run Search via
                        PassiveTotal Web Interface
                        {{fa-icon 'external-link-square' class='external-link-icon'}}</a>
                    </div>
                    <div>
                      <span class='p-footnote'>Some searches via the PassiveTotal API take too long to respond. Click the link
                        to run the search via the PassiveTotal website instead.</span>
                    </div>
                  {{else if details.reputation.apiKeyLimitReached}}
                    <span>{{fa-icon icon='exclamation-circle' fixedWidth=true class='details-icon'}}
                      You have reached your PassiveTotal API Search Quota. Please view your Search Quota below to determine when
                      you will be able to run searches again.</span>
                    <div class='mt-1'>
                      <a class='p-link' href='https://community.riskiq.com/research?query={{block.entity.value}}'>Run Search via
                        PassiveTotal Web Interface
                        {{fa-icon 'external-link-square' class='external-link-icon'}}</a>
                    </div>
                    <div>
                      <span class='p-footnote'>Use the link to run this search via the PassiveTotal website which uses a
                        different quota.</span>
                    </div>
                    {{#if details.quota.user}}
                      <div class='mt-1'>
                        <div>
                          <span class='p-title'>{{fa-icon icon='user' fixedWidth=true}} Your User Search Quota</span>
                        </div>
                        <div>
                          <span class='p-key'>API Searches:</span>
                          <span class='p-value'>{{details.quota.user.licenseCounts.searchApi}}
                            of
                            {{details.quota.user.licenseLimits.searchApi}}
                            used</span>
                        </div>
                        <div>
                          <span class='p-key'>Quota Duration: </span>
                          <span class='p-value'>{{details.quota.user.quotaInterval}}</span>
                        </div>
                        <div>
                          <span class='p-key'>Next Quota Reset: </span>
                          <span class='p-value'>{{details.quota.user.next_reset}}</span>
                        </div>
                      </div>
                    {{/if}}
                    {{#if details.quota.organization}}
                      <div class='mt-1'>
                        <div>
                          <span class='p-title mt-0'>{{fa-icon icon='building' fixedWidth=true}}
                            Your Organization Search Quota</span>
                        </div>
                        <div>
                          <span class='p-key'>API Searches: </span>
                          <span class='p-value'>{{details.quota.organization.licenseCounts.enterprise.searchApi}}
                            of
                            {{details.quota.organization.licenseLimits.enterprise.searchApi}}
                            used</span>
                        </div>
                        <div>
                          <span class='p-key'>Quota Duration:</span>
                          <span>{{details.quota.organization.quotaInterval}}</span>
                        </div>
                        <div>
                          <span class='p-key'>Next Quota Reset: </span>
                          <span class='p-value'>{{details.quota.organization.next_reset}}</span>
                        </div>
                      </div>
                    {{/if}}
                  {{else}}
                    <div class='mt-1'>
                      <span>A temporary PassiveTotal API search limit was reached. You can retry your search by pressing the
                        "Retry Reputation Search" button.</span>
                    </div>
                  {{/if}}
                </div>
              {{else}}
                {{#if block._state.visible.reputation}}
                  {{#if details.reputation.data}}
                    {{#if (or details.reputation.data.score (eq details.reputation.data.score 0))}}
                      <div>
                        <span class='p-key'>Score: </span>
                        <span class='p-value'>{{details.reputation.data.score}}</span>
                      </div>
                    {{/if}}
                    {{#if details.reputation.data.classification}}
                      <div>
                        <span class='p-key'>Classification: </span>
                        <span class='p-value'>{{details.reputation.data.classification}}</span>
                      </div>
                    {{/if}}
                    {{#each details.reputation.data.rules as |rule ruleIndex|}}
                      <h1 class='p-title'>
                        {{fa-icon 'check' fixedWidth=true}}
                        Rule #{{inc ruleIndex}}
                        Detail
                      </h1>
                      <div class='mb-2'>
                        {{#if rule.link}}
                          <div>
                            <span class='p-key'>Name: </span>
                            <span class='p-value'><a href='{{rule.link}}'>{{rule.name}}
                              {{fa-icon 'external-link-square' class='external-link-icon'}}</a></span>
                          </div>
                        {{else}}
                          <div>
                            <span class='p-key'>Name: </span>
                            <span class='p-value'>{{rule.name}}</span>
                          </div>
                        {{/if}}
                        {{#if rule.description}}
                          <div>
                            <span class='p-key'>Description: </span>
                            <span class='p-value'>{{rule.description}}</span>
                          </div>
                        {{/if}}
                        {{#if rule.severity}}
                          <div>
                            <span class='p-key'>Severity: </span>
                            <span class='p-value'>{{rule.severity}}</span>
                          </div>
                        {{/if}}
                      </div>
                    {{/each}}
                  {{else if details.reputation.accessDenied}}
                    <div class='alert alert-warning' role='alert'>
                      <div>Your API Key does not have access to Reputation data.</div>
                      <div class="p-footnote mt-1">
                        You can disable this data source via the integration's "Datasources" option.
                      </div>
                    </div>
                  {{else}}
                    <div>
                      No Reputation Details Found
                    </div>
                  {{/if}}
                {{/if}}
              {{/if}}
            </div>
          {{/if}}
        {{/if}}
        {{! end of reputation}}

        {{! start of articles }}
        {{#if enabledDatasources.articles}}
          <div class='sticky-header' {{action 'toggleShowResults' 'articles'}}>
            <div>
              {{fa-icon icon="newspaper" fixedWidth=true class="sticky-header-icon"}}
              Articles
              {{#if details.articles.data.length}}
                {{#if block._state.expanded.articles}}
                  ({{details.articles.data.length}})
                {{else}}
                  (10/{{details.articles.data.length}})
                {{/if}}
              {{/if}}
            </div>
            {{#if (and block._state.visible.articles (gt details.articles.data.length 10))}}
              <div>
                <span class="header-action" {{action "toggleExpanded" "articles" bubbles=false}}>
                  {{#if details.articles.data.length}}
                    {{#if block._state.expanded.articles}}
                      Show fewer results
                    {{else}}
                      Show all results
                    {{/if}}
                  {{/if}}
                </span>
              </div>
            {{/if}}
            <div class='p-action'>
              {{fa-icon (if block._state.visible.articles 'caret-up' 'caret-down') fixedWidth=true}}
            </div>
          </div>
          {{#if block._state.visible.articles}}
            <div class="padded sticky-body">
              {{#if (and block._state.searchRunning.articles (not block._state.initialLoadAttempted.articles))}}
                <div>
                  {{fa-icon icon='spinner-third' fixedWidth=true spin=true}}
                  Loading Articles
                </div>
              {{else if (or
                      details.articles.isConnectionReset
                      details.articles.maxRequestQueueLimitHit
                      details.articles.isGatewayTimeout
                      details.articles.apiKeyLimitReached
                      details.articles.onMessageTimeout
              )}}
                {{#unless details.articles.apiKeyLimitReached}}
                  <button type='button' class='btn btn-polarity btn-sm retry-btn mt-1' {{action 'retrySearch' 'articles'}}>
                    {{#if block._state.searchRunning.articles}}
                      {{fa-icon icon='spinner-third' fixedWidth=true spin=true}}
                    {{else}}
                      Retry Articles Search
                    {{/if}}
                  </button>
                {{/unless}}
                <div class='mt-1'>
                  {{#if details.articles.onMessageTimeout}}
                    <span>The PassiveTotal API took too long to respond. You can retry your search by pressing the "Retry
                    Articles Search" button.</span>
                    <div class='mt-1'>
                      <a class='p-link' href='https://community.riskiq.com/research?query={{block.entity.value}}'>Run Search via
                        PassiveTotal Web Interface
                        {{fa-icon 'external-link-square' class='external-link-icon'}}</a>
                    </div>
                    <div>
                    <span class='p-footnote'>Some searches via the PassiveTotal API take too long to respond. Click the link
                      to run the search via the PassiveTotal website instead.</span>
                    </div>
                  {{else if details.articles.apiKeyLimitReached}}
                    <span>{{fa-icon icon='exclamation-circle' fixedWidth=true class='details-icon'}}
                      You have reached your PassiveTotal API Search Quota. Please view your Search Quota below to determine when
                    you will be able to run searches again.</span>
                    <div class='mt-1'>
                      <a class='p-link' href='https://community.riskiq.com/research?query={{block.entity.value}}'>Run Search via
                        PassiveTotal Web Interface
                        {{fa-icon 'external-link-square' class='external-link-icon'}}</a>
                    </div>
                    <div>
                    <span class='p-footnote'>Use the link to run this search via the PassiveTotal website which uses a
                      different quota.</span>
                    </div>
                    {{#if details.quota.user}}
                      <div class='mt-1'>
                        <div>
                          <span class='p-title'>{{fa-icon icon='user' fixedWidth=true}} Your User Search Quota</span>
                        </div>
                        <div>
                          <span class='p-key'>API Searches:</span>
                          <span class='p-value'>{{details.quota.user.licenseCounts.searchApi}}
                            of
                            {{details.quota.user.licenseLimits.searchApi}}
                            used</span>
                        </div>
                        <div>
                          <span class='p-key'>Quota Duration: </span>
                          <span class='p-value'>{{details.quota.user.quotaInterval}}</span>
                        </div>
                        <div>
                          <span class='p-key'>Next Quota Reset: </span>
                          <span class='p-value'>{{details.quota.user.next_reset}}</span>
                        </div>
                      </div>
                    {{/if}}
                    {{#if details.quota.organization}}
                      <div class='mt-1'>
                        <div>
                        <span class='p-title mt-0'>{{fa-icon icon='building' fixedWidth=true}}
                          Your Organization Search Quota</span>
                        </div>
                        <div>
                          <span class='p-key'>API Searches: </span>
                          <span class='p-value'>{{details.quota.organization.licenseCounts.enterprise.searchApi}}
                            of
                            {{details.quota.organization.licenseLimits.enterprise.searchApi}}
                            used</span>
                        </div>
                        <div>
                          <span class='p-key'>Quota Duration:</span>
                          <span>{{details.quota.organization.quotaInterval}}</span>
                        </div>
                        <div>
                          <span class='p-key'>Next Quota Reset: </span>
                          <span class='p-value'>{{details.quota.organization.next_reset}}</span>
                        </div>
                      </div>
                    {{/if}}
                  {{else}}
                    <div class='mt-1'>
                    <span>A temporary PassiveTotal API search limit was reached. You can retry your search by pressing the
                      "Retry Articles Search" button.</span>
                    </div>
                  {{/if}}
                </div>
              {{else}}
                {{#if block._state.visible.articles}}
                  {{#if details.articles.data.length}}
                    <h1 class='p-title'>
                      {{fa-icon 'newspaper' fixedWidth=true}}
                      Article Indicator Details
                    </h1>
                    {{#each (take (if block._state.expanded.articles details.articles.data.length 10) details.articles.data)  as |article index|}}
                      <div class='mb-2'>
                        <h1 class='p-title'>
                          {{article.title}}
                        </h1>
                        {{#if article.summary}}
                          <div>
                            <span class='p-key'>Summary: </span>
                            <div class='summary'>
                              <span class='p-value summary'>{{article.summary}}</span>
                            </div>
                          </div>
                        {{/if}}
                        {{#if article.type}}
                          <div>
                            <span class='p-key'>Type: </span>
                            <span class='p-value'>{{capitalize article.type}}</span>
                          </div>
                        {{/if}}
                        {{#if article.publishedDate}}
                          <div>
                            <span class='p-key'>Published Date: </span>
                            <span class='p-value'>{{moment-format
                                    article.publishedDate
                                    'MM/DD/YYYY HH:mm:ss'
                                    timeZone=timezone
                            }}</span>
                          </div>
                        {{/if}}
                        {{#if article.link}}
                          <div>
                            <span class='p-key'>Link: </span>
                            <span class='p-value'>
                            <a href={{article.link}}>View Full Article
                              {{fa-icon 'external-link-square' class='external-link-icon'}}</a>
                          </span>
                          </div>
                        {{/if}}
                        {{#if article.categories}}
                          <div>
                            <span class='p-key'>Categories: </span>
                            <span class='p-value'>{{article.categories}}</span>
                          </div>
                        {{/if}}
                        {{#if article.tags.length}}
                          <div>
                            <span class='p-key'>Tags: </span>
                            <div class='p-value'>
                              {{#each article.tags as |tag|}}
                                <span class='tag'>{{tag}}</span>
                              {{/each}}
                            </div>
                          </div>
                        {{/if}}
                      </div>
                    {{/each}}
                    {{#unless block._state.expanded.articles}}
                      <span class="p-footnote">Showing first 10 results</span>
                    {{/unless}}
                    <div class='p-footnote mt-1'>This tab only displays articles where the entity
                    <b>{{block.entity.value}}</b>
                    is listed as an indicator.</div>
                  {{else if details.articles.accessDenied}}
                    <div class='alert alert-warning'>
                      <div>Your API Key does not have access to the Articles data source.</div>
                      <div class="p-footnote mt-1">
                        You can disable this data source via the integration's "Datasources" option.
                      </div>
                    </div>
                  {{else}}
                    <div>
                      No Articles Found
                    </div>
                    <div>
                    <div class='p-footnote mt-1'>This tab only displays articles where the entity
                      <b>{{block.entity.value}}</b>
                      is listed as an indicator.</div>
                    </div>
                  {{/if}}
                {{/if}}
              {{/if}}
            </div>
          {{/if}}
        {{/if}}
        {{! end of articles }}

        {{! start of certs }}
        {{#if enabledDatasources.sslCertsEnabled}}
          <div class='sticky-header' {{action 'toggleShowResults' 'certificates'}}>
            <div>
              {{fa-icon icon="certificate" fixedWidth=true class="sticky-header-icon"}}
              SSL Certs
            </div>
            <div class='p-action'>
              {{fa-icon (if block._state.visible.certificates 'caret-up' 'caret-down') fixedWidth=true}}
            </div>
          </div>
          {{#if block._state.visible.certificates}}
            <div class="padded sticky-body">
              {{#if (and block._state.searchRunning.certificates (not block._state.initialLoadAttempted.certificates))}}
                <div class='loading-message' role='alert'>
                  {{fa-icon icon='spinner-third' fixedWidth=true spin=true}}
                  Loading SSL Certificates
                </div>
              {{else if (or
                      details.certificates.isConnectionReset
                      details.certificates.maxRequestQueueLimitHit
                      details.certificates.isGatewayTimeout
                      details.certificates.apiKeyLimitReached
                      details.certificates.onMessageTimeout
              )}}
                {{#unless details.certificates.apiKeyLimitReached}}
                  <button type='button' class='btn btn-polarity btn-sm retry-btn mt-1' {{action 'retrySearch' 'certificates'}}>
                    {{#if block._state.searchRunning.certificates}}
                      {{fa-icon icon='spinner-third' fixedWidth=true spin=true}}
                    {{else}}
                      Retry Certificates Search
                    {{/if}}
                  </button>
                {{/unless}}
                <div class='mt-1'>
                  {{#if details.certificates.onMessageTimeout}}
                    <span>The PassiveTotal API took too long to respond. You can retry your search by pressing the "Retry
                      Certificates Search" button.</span>
                    <div class='mt-1'>
                      <a class='p-link' href='https://community.riskiq.com/research?query={{block.entity.value}}'>Run Search via
                        PassiveTotal Web Interface
                        {{fa-icon 'external-link-square' class='external-link-icon'}}</a>
                    </div>
                    <div>
                      <span class='p-footnote'>Some searches via the PassiveTotal API take too long to respond. Click the link
                        to run the search via the PassiveTotal website instead.</span>
                    </div>
                  {{else if details.certificates.apiKeyLimitReached}}
                    <span>{{fa-icon icon='exclamation-circle' fixedWidth=true class='details-icon'}}
                      You have reached your PassiveTotal API Search Quota. Please view your Search Quota below to determine when
                      you will be able to run searches again.</span>
                    <div class='mt-1'>
                      <a class='p-link' href='https://community.riskiq.com/research?query={{block.entity.value}}'>Run Search via
                        PassiveTotal Web Interface
                        {{fa-icon 'external-link-square' class='external-link-icon'}}</a>
                    </div>
                    <div>
                      <span class='p-footnote'>Use the link to run this search via the PassiveTotal website which uses a
                        different quota.</span>
                    </div>
                    {{#if details.quota.user}}
                      <div class='mt-1'>
                        <div>
                          <span class='p-title'>{{fa-icon icon='user' fixedWidth=true}} Your User Search Quota</span>
                        </div>
                        <div>
                          <span class='p-key'>API Searches:</span>
                          <span class='p-value'>{{details.quota.user.licenseCounts.searchApi}}
                            of
                            {{details.quota.user.licenseLimits.searchApi}}
                            used</span>
                        </div>
                        <div>
                          <span class='p-key'>Quota Duration: </span>
                          <span class='p-value'>{{details.quota.user.quotaInterval}}</span>
                        </div>
                        <div>
                          <span class='p-key'>Next Quota Reset: </span>
                          <span class='p-value'>{{details.quota.user.next_reset}}</span>
                        </div>
                      </div>
                    {{/if}}
                    {{#if details.quota.organization}}
                      <div class='mt-1'>
                        <div>
                          <span class='p-title mt-0'>{{fa-icon icon='building' fixedWidth=true}}
                            Your Organization Search Quota</span>
                        </div>
                        <div>
                          <span class='p-key'>API Searches: </span>
                          <span class='p-value'>{{details.quota.organization.licenseCounts.enterprise.searchApi}}
                            of
                            {{details.quota.organization.licenseLimits.enterprise.searchApi}}
                            used</span>
                        </div>
                        <div>
                          <span class='p-key'>Quota Duration:</span>
                          <span>{{details.quota.organization.quotaInterval}}</span>
                        </div>
                        <div>
                          <span class='p-key'>Next Quota Reset: </span>
                          <span class='p-value'>{{details.quota.organization.next_reset}}</span>
                        </div>
                      </div>
                    {{/if}}
                  {{else}}
                    <div class='mt-1'>
                      <span>A temporary PassiveTotal API search limit was reached. You can retry your search by pressing the
                        "Retry Certificates Search" button.</span>
                    </div>
                  {{/if}}
                </div>
              {{else}}
                {{#if block._state.visible.certificates}}
                  {{#if details.certificates.data.length}}
                    {{#each details.certificates.data as |certificate index|}}
                      {{#if (gt index 0)}}
                        <hr />
                      {{/if}}
                      <div class='mb-2'>
                        <h1 class='p-title'>
                          Certification Info
                        </h1>
                        {{#if certificate.sslVersion}}
                          <div>
                            <span class='p-key'>SSL Version: </span>
                            <span class='p-value'>{{certificate.sslVersion}}</span>
                          </div>
                        {{/if}}
                        {{#if certificate.fingerprint}}
                          <div>
                            <span class='p-key'>Fingerprint: </span>
                            <span class='p-value'>{{certificate.fingerprint}}</span>
                          </div>
                        {{/if}}
                        {{#if certificate.sha1}}
                          <div>
                            <span class='p-key'>SHA1: </span>
                            <span class='p-value'>{{certificate.sha1}}</span>
                          </div>
                        {{/if}}
                        {{#if certificate.serialNumber}}
                          <div>
                            <span class='p-key'>Serial Number: </span>
                            <span class='p-value'>{{certificate.serialNumber}}</span>
                          </div>
                        {{/if}}
                        {{#if certificate.expirationDate}}
                          <div>
                            <span class='p-key'>Expiration Date: </span>
                            <span class='p-value'>{{moment-format
                                    certificate.expirationDate
                                    'MM/DD/YYYY HH:mm:ss'
                                    timeZone=timezone
                            }}</span>
                          </div>
                        {{/if}}
                        {{#if certificate.issueDate}}
                          <div>
                            <span class='p-key'>Issue Date: </span>
                            <span class='p-value'>{{moment-format
                                    certificate.issueDate
                                    'MM/DD/YYYY HH:mm:ss'
                                    timeZone=timezone
                            }}</span>
                          </div>
                        {{/if}}
                        {{#if certificate.firstSeen}}
                          <div>
                            <span class='p-key'>First Seen: </span>
                            <span class='p-value'>{{moment-format
                                    certificate.firstSeen
                                    'MM/DD/YYYY HH:mm:ss'
                                    timeZone=timezone
                            }}</span>
                          </div>
                        {{/if}}
                        {{#if certificate.lastSeen}}
                          <div>
                            <span class='p-key'>Last Seen: </span>
                            <span class='p-value'>{{moment-format
                                    certificate.lastSeen
                                    'MM/DD/YYYY HH:mm:ss'
                                    timeZone=timezone
                            }}</span>
                          </div>
                        {{/if}}
                      </div>
                      <div class='mb-2'>
                        <h1 class='p-title'>
                          Subject Cert Info
                        </h1>
                        {{#if certificate.subjectCommonName}}
                          <div>
                            <span class='p-key'>Subject Common Name: </span>
                            <span class='p-value'>{{certificate.subjectCommonName}}</span>
                          </div>
                        {{/if}}
                        {{#if certificate.subjectGivenName}}
                          <div>
                            <span class='p-key'>Subject Given Name: </span>
                            <span class='p-value'>{{certificate.subjectGivenName}}</span>
                          </div>
                        {{/if}}
                        {{#if certificate.subjectSurname}}
                          <div>
                            <span class='p-key'>Subject Surname: </span>
                            <span class='p-value'>{{certificate.subjectSurname}}</span>
                          </div>
                        {{/if}}
                        {{#if certificate.subjectAlternativeNames.length}}
                          <div>
                            <span class='p-key'>Subject Alternative Names: </span>
                            <span class='p-value'>{{join ', ' certificate.subjectAlternativeNames}}</span>
                          </div>
                        {{/if}}
                        {{#if certificate.subjectLocalityName}}
                          <div>
                            <span class='p-key'>Subject Locality Name: </span>
                            <span class='p-value'>{{certificate.subjectLocalityName}}</span>
                          </div>
                        {{/if}}
                        {{#if certificate.subjectOrganizationName}}
                          <div>
                            <span class='p-key'>Subject Organization Name: </span>
                            <span class='p-value'>{{certificate.subjectOrganizationName}}</span>
                          </div>
                        {{/if}}
                        {{#if certificate.subjectOrganizationUnitName}}
                          <div>
                            <span class='p-key'>Subject Organization Unit Name: </span>
                            <span class='p-value'>{{certificate.subjectOrganizationUnitName}}</span>
                          </div>
                        {{/if}}
                        {{#if certificate.subjectSerialNumber}}
                          <div>
                            <span class='p-key'>Subject Serial Number: </span>
                            <span class='p-value'>{{certificate.subjectSerialNumber}}</span>
                          </div>
                        {{/if}}
                        {{#if certificate.subjectEmailAddress}}
                          <div>
                            <span class='p-key'>Subject Email Address: </span>
                            <span class='p-value'>{{certificate.subjectEmailAddress}}</span>
                          </div>
                        {{/if}}
                        {{#if certificate.subjectStreetAddress}}
                          <div>
                            <span class='p-key'>Subject Street Address: </span>
                            <span class='p-value'>{{certificate.subjectStreetAddress}}</span>
                          </div>
                        {{/if}}
                        {{#if certificate.subjectStateOrProvinceName}}
                          <div>
                            <span class='p-key'>Subject State Or Province Name: </span>
                            <span class='p-value'>{{certificate.subjectStateOrProvinceName}}</span>
                          </div>
                        {{/if}}
                        {{#if certificate.subjectCountry}}
                          <div>
                            <span class='p-key'>Subject Country: </span>
                            <span class='p-value'>{{certificate.subjectCountry}}</span>
                          </div>
                        {{/if}}
                      </div>
                      <div class='mb-2'>
                        <h1 class='p-title'>
                          Issuer Cert Info
                        </h1>
                        {{#if certificate.issuerCommonName}}
                          <div>
                            <span class='p-key'>Issuer Common Name: </span>
                            <span class='p-value'>{{certificate.issuerCommonName}}</span>
                          </div>
                        {{/if}}
                        {{#if certificate.issuerGivenName}}
                          <div>
                            <span class='p-key'>Issuer Given Name: </span>
                            <span class='p-value'>{{certificate.issuerGivenName}}</span>
                          </div>
                        {{/if}}
                        {{#if certificate.issuerSurname}}
                          <div>
                            <span class='p-key'>Issuer Surname: </span>
                            <span class='p-value'>{{certificate.issuerSurname}}</span>
                          </div>
                        {{/if}}
                        {{#if certificate.issuerEmailAddress}}
                          <div>
                            <span class='p-key'>Issuer Email Address: </span>
                            <span class='p-value'>{{certificate.issuerEmailAddress}}</span>
                          </div>
                        {{/if}}
                        {{#if certificate.issuerOrganizationName}}
                          <div>
                            <span class='p-key'>Issuer Organization Name: </span>
                            <span class='p-value'>{{certificate.issuerOrganizationName}}</span>
                          </div>
                        {{/if}}
                        {{#if certificate.issuerOrganizationUnitName}}
                          <div>
                            <span class='p-key'>Issuer Organization Unit Name: </span>
                            <span class='p-value'>{{certificate.issuerOrganizationUnitName}}</span>
                          </div>
                        {{/if}}
                        {{#if certificate.issuerSerialNumber}}
                          <div>
                            <span class='p-key'>Issuer Serial Number: </span>
                            <span class='p-value'>{{certificate.issuerSerialNumber}}</span>
                          </div>
                        {{/if}}
                        {{#if certificate.issuerStreetAddress}}
                          <div>
                            <span class='p-key'>Issuer Street Address: </span>
                            <span class='p-value'>{{certificate.issuerStreetAddress}}</span>
                          </div>
                        {{/if}}
                        {{#if certificate.issuerStateOrProvinceName}}
                          <div>
                            <span class='p-key'>Issuer State Or Province Name: </span>
                            <span class='p-value'>{{certificate.issuerStateOrProvinceName}}</span>
                          </div>
                        {{/if}}
                        {{#if certificate.issuerLocalityName}}
                          <div>
                            <span class='p-key'>Issuer Locality Name: </span>
                            <span class='p-value'>{{certificate.issuerLocalityName}}</span>
                          </div>
                        {{/if}}
                        {{#if certificate.issuerCountry}}
                          <div>
                            <span class='p-key'>Issuer Country: </span>
                            <span class='p-value'>{{certificate.issuerCountry}}</span>
                          </div>
                        {{/if}}
                      </div>
                    {{/each}}
                  {{else if details.certificates.accessDenied}}
                    <div class='alert alert-warning' role='alert'>
                      <div>Your API Key does not have access to the Certificates data source.</div>
                      <div class="p-footnote mt-1">
                        You can disable this data source via the integration's "Datasources" option.
                      </div>
                    </div>
                  {{else}}
                    <div>
                      No SSL Certificates Details Found
                    </div>
                    <div>
                      <span class='p-footnote mt-2'>Certificate searches only look for matches against the "subjectCommonName"
                        field of the certificate</span>
                    </div>
                  {{/if}}
                {{/if}}
              {{/if}}
            </div>
          {{/if}}
        {{/if}}
        {{! end of certs }}

        {{! start of osint }}
        {{#if enabledDatasources.osint}}
          <div class='sticky-header' {{action 'toggleShowResults' 'osint'}}>
            <div>
              {{fa-icon icon="wrench" fixedWidth=true class="sticky-header-icon"}}
              OSINT
              {{#if details.osint.data.length}}
                {{#if block._state.expanded.osint}}
                  ({{details.osint.data.length}})
                {{else}}
                  (10/{{details.osint.data.length}})
                {{/if}}
              {{/if}}
            </div>
            {{#if (and block._state.visible.osint (gt details.osint.data.length 10))}}
              <div>
                <span class="header-action" {{action "toggleExpanded" "osint" bubbles=false}}>
                  {{#if details.osint.data.length}}
                    {{#if block._state.expanded.osint}}
                      Show fewer results
                    {{else}}
                      Show all results
                    {{/if}}
                  {{/if}}
                </span>
              </div>
            {{/if}}
            <div class='p-action'>
              {{fa-icon (if block._state.visible.osint 'caret-up' 'caret-down') fixedWidth=true}}
            </div>
          </div>
          {{#if block._state.visible.osint}}
            <div class="padded sticky-body">
              {{#if (and block._state.searchRunning.osint (not block._state.initialLoadAttempted.osint))}}
                <div class='loading-message'>
                  {{fa-icon icon='spinner-third' fixedWidth=true spin=true}}
                  Loading OSINT
                </div>
              {{else if (or
                      details.osint.isConnectionReset
                      details.osint.maxRequestQueueLimitHit
                      details.osint.isGatewayTimeout
                      details.osint.apiKeyLimitReached
                      details.osint.onMessageTimeout
              )}}
                {{#unless details.osint.apiKeyLimitReached}}
                  <button type='button' class='btn btn-polarity btn-sm retry-btn mt-1' {{action 'retrySearch' 'osint'}}>
                    {{#if block._state.searchRunning.osint}}
                      {{fa-icon icon='spinner-third' fixedWidth=true spin=true}}
                    {{else}}
                      Retry OSINT Search
                    {{/if}}
                  </button>
                {{/unless}}
                <div class='mt-1'>
                  {{#if details.osint.onMessageTimeout}}
                    <span>The PassiveTotal API took too long to respond. You can retry your search by pressing the "Retry OSINT
                      Search" button.</span>
                    <div class='mt-1'>
                      <a class='p-link' href='https://community.riskiq.com/research?query={{block.entity.value}}'>Run Search via
                        PassiveTotal Web Interface
                        {{fa-icon 'external-link-square' class='external-link-icon'}}</a>
                    </div>
                    <div>
                      <span class='p-footnote'>Some searches via the PassiveTotal API take too long to respond. Click the link
                        to run the search via the PassiveTotal website instead.</span>
                    </div>
                  {{else if details.osint.apiKeyLimitReached}}
                    <span>{{fa-icon icon='exclamation-circle' fixedWidth=true class='details-icon'}}
                      You have reached your PassiveTotal API Search Quota. Please view your Search Quota below to determine when
                      you will be able to run searches again.</span>
                    <div class='mt-1'>
                      <a class='p-link' href='https://community.riskiq.com/research?query={{block.entity.value}}'>Run Search via
                        PassiveTotal Web Interface
                        {{fa-icon 'external-link-square' class='external-link-icon'}}</a>
                    </div>
                    <div>
                      <span class='p-footnote'>Use the link to run this search via the PassiveTotal website which uses a
                        different quota.</span>
                    </div>
                    {{#if details.quota.user}}
                      <div class='mt-1'>
                        <div>
                          <span class='p-title'>{{fa-icon icon='user' fixedWidth=true}} Your User Search Quota</span>
                        </div>
                        <div>
                          <span class='p-key'>API Searches:</span>
                          <span class='p-value'>{{details.quota.user.licenseCounts.searchApi}}
                            of
                            {{details.quota.user.licenseLimits.searchApi}}
                            used</span>
                        </div>
                        <div>
                          <span class='p-key'>Quota Duration: </span>
                          <span class='p-value'>{{details.quota.user.quotaInterval}}</span>
                        </div>
                        <div>
                          <span class='p-key'>Next Quota Reset: </span>
                          <span class='p-value'>{{details.quota.user.next_reset}}</span>
                        </div>
                      </div>
                    {{/if}}
                    {{#if details.quota.organization}}
                      <div class='mt-1'>
                        <div>
                          <span class='p-title mt-0'>{{fa-icon icon='building' fixedWidth=true}}
                            Your Organization Search Quota</span>
                        </div>
                        <div>
                          <span class='p-key'>API Searches: </span>
                          <span class='p-value'>{{details.quota.organization.licenseCounts.enterprise.searchApi}}
                            of
                            {{details.quota.organization.licenseLimits.enterprise.searchApi}}
                            used</span>
                        </div>
                        <div>
                          <span class='p-key'>Quota Duration:</span>
                          <span>{{details.quota.organization.quotaInterval}}</span>
                        </div>
                        <div>
                          <span class='p-key'>Next Quota Reset: </span>
                          <span class='p-value'>{{details.quota.organization.next_reset}}</span>
                        </div>
                      </div>
                    {{/if}}
                  {{else}}
                    <div class='mt-1'>
                      <span>A temporary PassiveTotal API search limit was reached. You can retry your search by pressing the
                        "Retry OSINT Search" button.</span>
                    </div>
                  {{/if}}
                </div>
              {{else}}
                {{#if block._state.visible.osint}}
                  {{#if details.osint.data}}
                    <div class='osint-container'>
                      {{#each (take (if block._state.expanded.osint details.osint.data.length 10) details.osint.data) as |info|}}
                        <div class='mb-2'>
                          {{#if info.source}}
                            <div>
                              <span class='p-key'>Source: </span>
                              <span class='p-value'>{{info.source}}</span>
                            </div>
                          {{/if}}
                          {{#if info.sourceUrl}}
                            <div>
                              <span class='p-key'>Source URL: </span>
                              <span class='p-value'>{{info.sourceUrl}}</span>
                            </div>
                          {{/if}}
                          {{#if info.tags.length}}
                            <div>
                              <span class='p-key'>Tags: </span>
                              {{#each info.tags as |tag|}}
                                <div class='tag-value'>
                                  <span class='tag'>{{tag}}</span>
                                </div>
                              {{/each}}
                            </div>
                          {{/if}}
                        </div>
                      {{/each}}
                    </div>
                  {{else if details.osint.accessDenied}}
                    <div class='alert alert-warning'>
                      <div>Your API Key does not have access to the OSINT data source.</div>
                      <div class="p-footnote mt-1">
                        You can disable this data source via the integration's "Datasources" option.
                      </div>
                    </div>
                  {{else}}
                    <span>
                      No OSINT Details Found
                    </span>
                  {{/if}}
                {{/if}}
              {{/if}}
            </div>
          {{/if}}
        {{/if}}
        {{!-- end of osint --}}

        {{!-- start of malware --}}
        {{#if enabledDatasources.malware}}
          <div class='sticky-header' {{action 'toggleShowResults' 'malware'}}>
            <div>
              {{fa-icon icon="viruses" fixedWidth=true class="sticky-header-icon"}}
              Malware
              {{#if details.malware.data.length}}
                {{#if block._state.expanded.malware}}
                  ({{details.malware.data.length}})
                {{else}}
                  (10/{{details.malware.data.length}})
                {{/if}}
              {{/if}}
            </div>
            {{#if (and block._state.visible.malware (gt details.malware.data.length 10))}}
              <div>
                <span class="header-action" {{action "toggleExpanded" "malware" bubbles=false}}>
                  {{#if details.malware.data.length}}
                    {{#if block._state.expanded.malware}}
                      Show fewer results
                    {{else}}
                      Show all results
                    {{/if}}
                  {{/if}}
                </span>
              </div>
            {{/if}}
            <div class="p-action">
              {{fa-icon (if block._state.visible.malware 'caret-up' 'caret-down') fixedWidth=true}}
            </div>
          </div>
          {{#if block._state.visible.malware}}
            <div class="padded sticky-body">
              {{#if (and block._state.searchRunning.malware (not block._state.initialLoadAttempted.malware))}}
                <div class="loading-message">
                  {{fa-icon icon='spinner-third' fixedWidth=true spin=true}}
                  Loading Malware
                </div>
              {{else if (or
                      details.malware.isConnectionReset
                      details.malware.maxRequestQueueLimitHit
                      details.malware.isGatewayTimeout
                      details.malware.apiKeyLimitReached
                      details.malware.onMessageTimeout
              )}}
                {{#unless details.malware.apiKeyLimitReached}}
                  <button type='button' class='btn btn-polarity btn-sm retry-btn mt-1' {{action 'retrySearch' 'malware'}}>
                    {{#if block._state.searchRunning.malware}}
                      {{fa-icon icon='spinner-third' fixedWidth=true spin=true}}
                    {{else}}
                      Retry Malware Search
                    {{/if}}
                  </button>
                {{/unless}}
                <div class='mt-1'>
                  {{#if details.malware.onMessageTimeout}}
                    <span>The PassiveTotal API took too long to respond. You can retry your search by pressing the "Retry
                  Malware Search" button.</span>
                    <div class='mt-1'>
                      <a class='p-link' href='https://community.riskiq.com/research?query={{block.entity.value}}'>Run Search via
                        PassiveTotal Web Interface
                        {{fa-icon 'external-link-square' class='external-link-icon'}}</a>
                    </div>
                    <div>
                  <span class='p-footnote'>Some searches via the PassiveTotal API take too long to respond. Click the link
                    to run the search via the PassiveTotal website instead.</span>
                    </div>
                  {{else if details.malware.apiKeyLimitReached}}
                    <span>{{fa-icon icon='exclamation-circle' fixedWidth=true class='details-icon'}}
                      You have reached your PassiveTotal API Search Quota. Please view your Search Quota below to determine when
                  you will be able to run searches again.</span>
                    <div class='mt-1'>
                      <a class='p-link' href='https://community.riskiq.com/research?query={{block.entity.value}}'>Run Search via
                        PassiveTotal Web Interface
                        {{fa-icon 'external-link-square' class='external-link-icon'}}</a>
                    </div>
                    <div>
                  <span class='p-footnote'>Use the link to run this search via the PassiveTotal website which uses a
                    different quota.</span>
                    </div>
                    {{#if details.quota.user}}
                      <div class='mt-1'>
                        <div>
                          <span class='p-title'>{{fa-icon icon='user' fixedWidth=true}} Your User Search Quota</span>
                        </div>
                        <div>
                          <span class='p-key'>API Searches:</span>
                          <span class='p-value'>{{details.quota.user.licenseCounts.searchApi}}
                            of
                            {{details.quota.user.licenseLimits.searchApi}}
                            used</span>
                        </div>
                        <div>
                          <span class='p-key'>Quota Duration: </span>
                          <span class='p-value'>{{details.quota.user.quotaInterval}}</span>
                        </div>
                        <div>
                          <span class='p-key'>Next Quota Reset: </span>
                          <span class='p-value'>{{details.quota.user.next_reset}}</span>
                        </div>
                      </div>
                    {{/if}}
                    {{#if details.quota.organization}}
                      <div class='mt-1'>
                        <div>
                      <span class='p-title mt-0'>{{fa-icon icon='building' fixedWidth=true}}
                        Your Organization Search Quota</span>
                        </div>
                        <div>
                          <span class='p-key'>API Searches: </span>
                          <span class='p-value'>{{details.quota.organization.licenseCounts.enterprise.searchApi}}
                            of
                            {{details.quota.organization.licenseLimits.enterprise.searchApi}}
                            used</span>
                        </div>
                        <div>
                          <span class='p-key'>Quota Duration:</span>
                          <span>{{details.quota.organization.quotaInterval}}</span>
                        </div>
                        <div>
                          <span class='p-key'>Next Quota Reset: </span>
                          <span class='p-value'>{{details.quota.organization.next_reset}}</span>
                        </div>
                      </div>
                    {{/if}}
                  {{else}}
                    <div class='mt-1'>
                  <span>A temporary PassiveTotal API search limit was reached. You can retry your search by pressing the
                    "Retry Malware Search" button.</span>
                    </div>
                  {{/if}}
                </div>
              {{else}}
                {{#if details.malware.data}}
                  <h1 class='p-title'>
                    {{fa-icon 'bug' fixedWidth=true}}
                    Malware Details
                  </h1>
                  {{#each (take (if block._state.expanded.malware details.malware.data.length 10) details.malware.data) as |result resultIndex|}}
                    <div class='mb-2'>
                      <div>
                        <span class='p-key'>Sample: </span>
                        <span class='p-value'><a
                                href='https://www.virustotal.com/gui/search/{{{result.sample}}}'
                        >{{{result.sample}}} (VT) {{fa-icon 'external-link-square' class='external-link-icon'}}</a></span>
                      </div>
                      <div>
                        <span class='p-key'>Collection Date: </span>
                        <span class='p-value'>{{result.collectionDate}}</span>
                      </div>
                      <div>
                        <span class='p-key'>Source: </span>
                        <span class='p-value'><a href='{{{result.sourceUrl}}}'>{{{result.source}}}
                          {{fa-icon 'external-link-square' class='external-link-icon'}}</a></span>
                      </div>
                    </div>
                  {{/each}}
                  {{#unless block._state.expanded.malware}}
                    <span class="p-footnote">Showing first 10 results</span>
                  {{/unless}}
                {{else if details.malware.accessDenied}}
                  <div class='alert alert-warning mt-2' role='alert'>
                    <div>Your API Key does not have access to the Malware data.</div>
                    <div class="p-footnote mt-1">
                      You can disable this data source via the integration's "Datasources" option.
                    </div>
                  </div>
                {{else}}
                  <div>
                    No Malware Details Found
                  </div>
                {{/if}}
              {{/if}}
            </div>
          {{/if}}
        {{/if}}

        {{!-- start of subdomains --}}
        {{#if enabledDatasources.subdomains}}
          <div class='sticky-header' {{action 'toggleShowResults' 'subdomains'}}>
            <div>
              {{fa-icon icon="globe" fixedWidth=true class="sticky-header-icon"}}
              Subdomains
              {{#if details.subdomains.data.subdomains.length}}
                {{#if block._state.expanded.subdomains}}
                  ({{details.subdomains.data.subdomains.length}})
                {{else}}
                  (10/{{details.subdomains.data.subdomains.length}})
                {{/if}}
              {{/if}}
            </div>
            {{#if (and block._state.visible.subdomains (gt details.subdomains.data.subdomains.length 10))}}
              <div>
                <span class="header-action" {{action "toggleExpanded" "subdomains" bubbles=false}}>
                  {{#if details.subdomains.data.subdomains.length}}
                    {{#if block._state.expanded.subdomains}}
                      Show fewer results
                    {{else}}
                      Show all results
                    {{/if}}
                  {{/if}}
                </span>
              </div>
            {{/if}}
            <div class="p-action">
              {{fa-icon (if block._state.visible.subdomains 'caret-up' 'caret-down') fixedWidth=true}}
            </div>
          </div>
          {{#if block._state.visible.subdomains}}
            <div class="padded sticky-body">
              {{#if (and block._state.searchRunning.subdomains (not block._state.initialLoadAttempted.subdomains))}}
                <div class="loading-message">
                  {{fa-icon icon='spinner-third' fixedWidth=true spin=true}}
                  Loading Subdomains
                </div>
              {{else if (or
                      details.subdomains.isConnectionReset
                      details.subdomains.maxRequestQueueLimitHit
                      details.subdomains.isGatewayTimeout
                      details.subdomains.apiKeyLimitReached
                      details.subdomains.onMessageTimeout
              )}}
                {{#unless details.subdomains.apiKeyLimitReached}}
                  <button type='button' class='btn btn-polarity btn-sm retry-btn mt-1' {{action 'retrySearch' 'subdomains'}}>
                    {{#if block._state.searchRunning.subdomains}}
                      {{fa-icon icon='spinner-third' fixedWidth=true spin=true}}
                    {{else}}
                      Retry subdomains Search
                    {{/if}}
                  </button>
                {{/unless}}
                <div class='mt-1'>
                  {{#if details.subdomains.onMessageTimeout}}
                    <span>The PassiveTotal API took too long to respond. You can retry your search by pressing the "Retry
                    subdomains Search" button.</span>
                    <div class='mt-1'>
                      <a class='p-link' href='https://community.riskiq.com/research?query={{block.entity.value}}'>Run Search via
                        PassiveTotal Web Interface
                        {{fa-icon 'external-link-square' class='external-link-icon'}}</a>
                    </div>
                    <div>
                    <span class='p-footnote'>Some searches via the PassiveTotal API take too long to respond. Click the link
                      to run the search via the PassiveTotal website instead.</span>
                    </div>
                  {{else if details.subdomains.apiKeyLimitReached}}
                    <span>{{fa-icon icon='exclamation-circle' fixedWidth=true class='details-icon'}}
                      You have reached your PassiveTotal API Search Quota. Please view your Search Quota below to determine when
                    you will be able to run searches again.</span>
                    <div class='mt-1'>
                      <a class='p-link' href='https://community.riskiq.com/research?query={{block.entity.value}}'>Run Search via
                        PassiveTotal Web Interface
                        {{fa-icon 'external-link-square' class='external-link-icon'}}</a>
                    </div>
                    <div>
                    <span class='p-footnote'>Use the link to run this search via the PassiveTotal website which uses a
                      different quota.</span>
                    </div>
                    {{#if details.quota.user}}
                      <div class='mt-1'>
                        <div>
                          <span class='p-title'>{{fa-icon icon='user' fixedWidth=true}} Your User Search Quota</span>
                        </div>
                        <div>
                          <span class='p-key'>API Searches:</span>
                          <span class='p-value'>{{details.quota.user.licenseCounts.searchApi}}
                            of
                            {{details.quota.user.licenseLimits.searchApi}}
                            used</span>
                        </div>
                        <div>
                          <span class='p-key'>Quota Duration: </span>
                          <span class='p-value'>{{details.quota.user.quotaInterval}}</span>
                        </div>
                        <div>
                          <span class='p-key'>Next Quota Reset: </span>
                          <span class='p-value'>{{details.quota.user.next_reset}}</span>
                        </div>
                      </div>
                    {{/if}}
                    {{#if details.quota.organization}}
                      <div class='mt-1'>
                        <div>
                        <span class='p-title mt-0'>{{fa-icon icon='building' fixedWidth=true}}
                          Your Organization Search Quota</span>
                        </div>
                        <div>
                          <span class='p-key'>API Searches: </span>
                          <span class='p-value'>{{details.quota.organization.licenseCounts.enterprise.searchApi}}
                            of
                            {{details.quota.organization.licenseLimits.enterprise.searchApi}}
                            used</span>
                        </div>
                        <div>
                          <span class='p-key'>Quota Duration:</span>
                          <span>{{details.quota.organization.quotaInterval}}</span>
                        </div>
                        <div>
                          <span class='p-key'>Next Quota Reset: </span>
                          <span class='p-value'>{{details.quota.organization.next_reset}}</span>
                        </div>
                      </div>
                    {{/if}}
                  {{else}}
                    <div class='mt-1'>
                    <span>A temporary PassiveTotal API search limit was reached. You can retry your search by pressing the
                      "Retry subdomains Search" button.</span>
                    </div>
                  {{/if}}
                </div>
              {{else}}
                {{#if block._state.visible.subdomains}}
                  {{#if details.subdomains.data.subdomains}}
                    <div class='subdomain-info'>
                      <div>
                        <span class='p-key'>Primary Domain: </span>
                        <span class='p-value'>{{details.subdomains.data.primaryDomain}}</span>
                      </div>

                      <div>
                        <span class='p-key'>Query Value: </span>
                        <span class='p-value'>{{details.subdomains.data.queryValue}}</span>
                      </div>
                    </div>
                    <table>
                      <tbody>
                      {{#each (take (if block._state.expanded.subdomains details.subdomains.data.subdomains.length 10) details.subdomains.data.subdomains) as |subdomain|}}
                        <tr>
                          <td class='pr-3'>
                            <div>
                              <span class='p-value'>{{subdomain}}</span>
                            </div>
                          </td>
                        </tr>
                      {{/each}}
                      </tbody>
                    </table>
                    {{#unless block._state.expanded.subdomains}}
                      <span class="p-footnote">Showing first 10 results</span>
                    {{/unless}}
                  {{else if details.subdomains.accessDenied}}
                    <div class='alert alert-warning' role='alert'>
                      <div>Your API Key does not have access to the Subdomains data source.</div>
                      <div class="p-footnote mt-1">
                        You can disable this data source via the integration's "Datasources" option.
                      </div>
                    </div>
                  {{else}}
                    <span>
                      No Subdomains Found
                    </span>
                  {{/if}}
                {{/if}}
              {{/if}}
            </div>
          {{/if}}
        {{/if}}
        {{!-- end of subdomains --}}
    </div>
  {{/if}}
{{/if}}

{{#if (eq block.entity.type 'custom')}}
  {{! Tracker output parsing}}
  <div class='view-in-pt'>
    <a href='https://community.riskiq.com/search/trackers/{{block.entity.value}}'>View in PassiveTotal
      {{fa-icon 'external-link-square' class='external-link-icon'}}</a>
  </div>
  <h1 class='p-title'>
    {{fa-icon 'code' fixedWidth=true}}
    Google Analytics Tracker Details
  </h1>
  {{#each details.tracker as |result index|}}
    <div class='mb-2'>
      <div>
        <span class='p-key'>Entity: </span>
        <a href='https://community.riskiq.com/search/{{result.entity}}'>{{result.entity}}
          {{fa-icon 'external-link-square' class='external-link-icon'}}</a>
      </div>
      <div>
        <span class='p-key'>First Seen: </span>
        <span class='p-value'>{{result.firstSeen}}</span>
      </div>
      <div>
        <span class='p-key'>Last Seen: </span>
        <span class='p-value'>{{result.lastSeen}}</span>
      </div>
    </div>
  {{/each}}
  {{! view quota }}
  <div class='mt-1'>
    <span class='p-action' {{action 'showQuota'}}>
      {{#if block._state.viewQuota}}
        Hide Search Quota
        {{fa-icon icon='chevron-up'}}
      {{else}}
        View Search Quota
        {{fa-icon icon='chevron-down'}}
      {{/if}}
    </span>
    {{#if block._state.searchRunning.quota}}
      <div class='mt-1'>
        {{fa-icon icon='spinner-third' fixedWidth=true spin=true}}
        Loading Quota ...
      </div>
    {{/if}}
    {{#if block._state.viewQuota}}
      {{#if details.quota}}
        <div class='quota-container mt-1'>
          {{#if details.quota.user}}
            <div>
              <div>
                <span class='p-title mt-0'>{{fa-icon icon='user' fixedWidth=true}} Your User Search Quota</span>
              </div>
              <div>
                <span class='p-key'>API Searches:</span>
                <span class='p-value'>{{details.quota.user.licenseCounts.searchApi}}
                  of
                  {{details.quota.user.licenseLimits.searchApi}}
                  used</span>
              </div>
              <div>
                <span class='p-key'>Quota Duration: </span>
                <span class='p-value'>{{details.quota.user.quotaInterval}}</span>
              </div>
              <div>
                <span class='p-key'>Next Quota Reset: </span>
                <span class='p-value'>{{details.quota.user.next_reset}}</span>
              </div>
            </div>
          {{/if}}
          {{#if details.quota.organization}}
            <div class='mt-1'>
              <div>
                <span class='p-title mt-0'>{{fa-icon icon='building' fixedWidth=true}}
                  Your Organization Search Quota</span>
              </div>
              <div>
                <span class='p-key'>API Searches: </span>
                <span class='p-value'>{{details.quota.organization.licenseCounts.enterprise.searchApi}}
                  of
                  {{details.quota.organization.licenseLimits.enterprise.searchApi}}
                  used</span>
              </div>
              <div>
                <span class='p-key'>Quota Duration:</span>
                <span>{{details.quota.organization.quotaInterval}}</span>
              </div>
              <div>
                <span class='p-key'>Next Quota Reset: </span>
                <span class='p-value'>{{details.quota.organization.next_reset}}</span>
              </div>
            </div>
          {{/if}}
          <span class='reload-quota-btn' {{action 'getQuota'}}>
            {{fa-icon
              icon='sync'
              fixedWidth=true
              class='icon'
              title='Refresh Quota'
              spin=(if block._state.searchRunning.quota true false)
            }}
          </span>
        </div>
      {{/if}}
    {{/if}}
  </div>
{{/if}}

{{#if (eq activeTab 'pdns')}}
  {{#if (and block._state.searchRunning.pdns (not block._state.initialLoadAttempted.pdns))}}
    <div class="loading-text mt-2">
      {{fa-icon icon='spinner-third' fixedWidth=true spin=true}}
      Loading Resolutions
    </div>
  {{else if (or
    details.pdns.isConnectionReset
    details.pdns.maxRequestQueueLimitHit
    details.pdns.isGatewayTimeout
    details.pdns.apiKeyLimitReached
    details.pdns.onMessageTimeout
  )}}
    {{#unless details.pdns.apiKeyLimitReached}}
      <button type='button' class='btn btn-polarity btn-sm retry-btn mt-1' {{action 'retrySearch' 'pdns'}}>
        {{#if block._state.searchRunning.pdns}}
          {{fa-icon icon='spinner-third' fixedWidth=true spin=true}}
        {{else}}
          Retry Resolutions Search
        {{/if}}
      </button>
    {{/unless}}
    <div class='mt-1'>
      {{#if details.pdns.onMessageTimeout}}
        <span>The PassiveTotal API took too long to respond. You can retry your search by pressing the "Retry Resolutions
          Search" button.</span>
        <div class='mt-1'>
          <a class='p-link' href='https://community.riskiq.com/research?query={{block.entity.value}}'>Run Search via
            PassiveTotal Web Interface
            {{fa-icon 'external-link-square' class='external-link-icon'}}</a>
        </div>
        <div>
          <span class='p-footnote'>Some searches via the PassiveTotal API take too long to respond. Click the link to
            run the search via the PassiveTotal website instead.</span>
        </div>
      {{else if details.pdns.apiKeyLimitReached}}
        <span>{{fa-icon icon='exclamation-circle' fixedWidth=true class='details-icon'}}
          You have reached your PassiveTotal API Search Quota. Please view your Search Quota below to determine when you
          will be able to run searches again.</span>
        <div class='mt-1'>
          <a class='p-link' href='https://community.riskiq.com/research?query={{block.entity.value}}'>Run Search via
            PassiveTotal Web Interface
            {{fa-icon 'external-link-square' class='external-link-icon'}}</a>
        </div>
        <div>
          <span class='p-footnote'>Use the link to run this search via the PassiveTotal website which uses a different
            quota.</span>
        </div>
        {{#if details.quota.user}}
          <div class='mt-1'>
            <div>
              <span class='p-title'>{{fa-icon icon='user' fixedWidth=true}} Your User Search Quota</span>
            </div>
            <div>
              <span class='p-key'>API Searches:</span>
              <span class='p-value'>{{details.quota.user.licenseCounts.searchApi}}
                of
                {{details.quota.user.licenseLimits.searchApi}}
                used</span>
            </div>
            <div>
              <span class='p-key'>Quota Duration: </span>
              <span class='p-value'>{{details.quota.user.quotaInterval}}</span>
            </div>
            <div>
              <span class='p-key'>Next Quota Reset: </span>
              <span class='p-value'>{{details.quota.user.next_reset}}</span>
            </div>
          </div>
        {{/if}}
        {{#if details.quota.organization}}
          <div class='mt-1'>
            <div>
              <span class='p-title mt-0'>{{fa-icon icon='building' fixedWidth=true}}
                Your Organization Search Quota</span>
            </div>
            <div>
              <span class='p-key'>API Searches: </span>
              <span class='p-value'>{{details.quota.organization.licenseCounts.enterprise.searchApi}}
                of
                {{details.quota.organization.licenseLimits.enterprise.searchApi}}
                used</span>
            </div>
            <div>
              <span class='p-key'>Quota Duration:</span>
              <span>{{details.quota.organization.quotaInterval}}</span>
            </div>
            <div>
              <span class='p-key'>Next Quota Reset: </span>
              <span class='p-value'>{{details.quota.organization.next_reset}}</span>
            </div>
          </div>
        {{/if}}
      {{else}}
        <div class='mt-1'>
          <span>A temporary PassiveTotal API search limit was reached. You can retry your search by pressing the "Retry
            Resolutions Search" button.</span>
        </div>
      {{/if}}
    </div>
  {{else}}
    {{#if (gt resolutions.length 0)}}
      <div class="mt-1 resolutions-filter">
        <div class="input-group">
          {{input
            type="text"
            class="form-control"
            placeholder="Filter resolutions"
            enter=(action "filterResolutions")
            value=block._state.resolutions.shadowFilter
          }}
          <PButton @naked={{true}} class="clear-filter" {{action "clearResolutionFilter"}} disabled={{eq block._state.resolutions.shadowFilter.length 0}}>
            <FaIcon @icon="times" />
          </PButton>
          <div class="input-group-append">
            <button {{action "filterResolutions"}} class="btn btn-outline-secondary" type="button" disabled={{eq block._state.resolutions.shadowFilter.length 0}}>Filter</button>
          </div>
        </div>
      </div>
      <div class="mt-1 d-flex align-items-center justify-space-between resolutions-sorting">
        <select
          class="form-control"
          onchange={{action (mut block._state.resolutions.sortValue) value="target.value"}}
          disabled={{ticketClosed}}
        >
          {{#each resolutionSortOptions as |sortOption|}}
            <option class="dropdown-option" selected={{eq block._state.resolutions.sortValue sortOption.value}} value={{sortOption.value}}>
              {{sortOption.display}}
            </option>
          {{/each}}
        </select>
        <select
          class="form-control"
          onchange={{action (mut block._state.resolutions.sortOrder) value="target.value"}}
          disabled={{ticketClosed}}
        >
          {{#each resolutionSortOrderOptions as |sortOption|}}
            <option class="dropdown-option" selected={{eq block._state.resolutions.sortOrder sortOption}} value={{sortOption}}>
              {{sortOption}}
            </option>
          {{/each}}
        </select>
      </div>
      <table class="resolutions p-table">
        <thead>
          <th class="resolution">Resolution</th>
          <th class="date">Timestamps</th>
        </thead>
        <tbody>
          {{#each resolutions as |pdns index|}}
            <tr>
              <td class="resolution">{{pdns.resolve}}</td>
              <td class="date">
                <div title="{{pdns.lastSeen}}"><span class="time">Last Seen</span> {{moment-format pdns.lastSeen "YYYY-MM-DD" timeZone=timezone}}</div>
                <div title="{{pdns.firstSeen}}"><span class="time">First Seen</span> {{moment-format pdns.firstSeen "YYYY-MM-DD" timeZone=timezone}}</div>
                <div title="{{pdns.collected}}"><span class="time">Collected</span> {{moment-format pdns.collected "YYYY-MM-DD" timeZone=timezone}}</div>
              </td>
            </tr>
          {{/each}}
        {{#if (eq resolutions.length 0)}}
          <tr>
            <td class="resolution">No results</td>
            <td>&nbsp;</td>
          </tr>
        {{/if}}
        </tbody>
      </table>
      <div class="paging-container mt-1 d-flex align-items-center justify-content-between">
        <div>
          <span class="next-hit-stats">Resolutions {{block._state.resolutions.startItem}} to {{block._state.resolutions.endItem}} of {{block._state.resolutions.filteredTotal}}</span>
        </div>
        <div>
          <span title="First Page" {{action "setPage" "firstPage"}} class="next-hit-button p-action">{{fa-icon icon="chevron-double-left" fixedWidth=true}}</span>
          <span title="Previous Page" {{action "setPage" -1}} class="next-hit-button p-action">{{fa-icon icon="chevron-left" fixedWidth=true}}</span>
          <span title="Next Page" {{action "setPage" 1}} class="next-hit-button ml-1 p-action">{{fa-icon icon="chevron-right" fixedWidth=true}}</span>
          <span title="Last Page" {{action "setPage" "lastPage"}} class="next-hit-button ml-1 p-action">{{fa-icon icon="chevron-double-right" fixedWidth=true}}</span>
        </div>
      </div>
    {{else if details.resolutions.accessDenied}}
      <div class='alert alert-warning mt-2' role='alert'>
        <div>Your API Key does not have access to the Resolutions data.</div>
        <div class="p-footnote mt-1">
          You can disable this data source via the integration's "Datasources" option.
        </div>
      </div>
    {{else}}
      <div class='alert alert-info mt-2' role='alert'>
        No Resolutions Found
      </div>
    {{/if}}
  {{/if}}
{{/if}}